<!DOCTYPE html>
<html lang="en"><head><title>Blog | Andreas Volkmann</title><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Blog" /><meta name="author" content="Andreas Volkmann" /><meta property="og:locale" content="en" /><meta name="description" content="A personal page for showcasing projects and talking about my interests." /><meta property="og:description" content="A personal page for showcasing projects and talking about my interests." /><link rel="canonical" href="https://andreasvolkmann.github.io//" /><meta property="og:url" content="https://andreasvolkmann.github.io//" /><meta property="og:site_name" content="Andreas Volkmann" /><meta property="og:image" content="https://andreasvolkmann.github.io//assets/img/hydejack-8.png" /><meta property="og:type" content="website" /><link rel="next" href="https://andreasvolkmann.github.io//page-2/" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://andreasvolkmann.github.io//assets/img/hydejack-8.png" /><meta property="twitter:title" content="Blog" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebSite","author":{"@type":"Person","name":"Andreas Volkmann"},"dateModified":"2020-02-14T09:38:56-08:00","description":"A personal page for showcasing projects and talking about my interests.","headline":"Blog","image":"https://andreasvolkmann.github.io//assets/img/hydejack-8.png","name":"Andreas Volkmann","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://andreasvolkmann.github.io//assets/icons/icon.png"},"name":"Andreas Volkmann"},"url":"https://andreasvolkmann.github.io//"}</script><meta name="keywords" content="andreas,volkmann"><meta name="color-scheme" content="dark light"><meta name="theme-color" content="rgb(25,55,71)"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Andreas Volkmann"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="Andreas Volkmann"><meta name="generator" content="Hydejack v9.2.1" /><link rel="alternate" href="https://andreasvolkmann.github.io//" hreflang="en"><link type="application/atom+xml" rel="alternate" href="https://andreasvolkmann.github.io//feed.xml" title="Andreas Volkmann" /><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_katexPreload"> <noscript><link rel="stylesheet" href="/assets/bower_components/katex/dist/katex.min.css"></noscript> <script>((r,a)=>{function d(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=a.createElement("script"),e=(n.src=e,t&&d(n,"load",t,{once:!0}),a.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=a.createElement("script");function o(){r._loaded=!0,t&&d(n,"load",t,{once:!0});var e=a.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():d(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){d(a.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}})(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/'; w._publicPath = '/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = false; w._search = { DATA_URL: '/assets/sitedata.json?no-cache', STORAGE_KEY: 'mini-search/', INDEX_KEY: 'index--2025-05-01T19:52:22-07:00', }; w._clapButton = false; }(window);</script> <!--[if gt IE 8]><!----><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,.content .avatar,.nav-btn,.nav-btn-bar,.navbar,.message,.note-sm,#markdown-toc,.note,.hr-bottom,.hr-after::after,hr,.hr,p,body{transition:none}#_dark-mode{font-size:1.25rem}@media screen{body,body.light-mode{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0, 0, 0, 0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg)}body .content,body.light-mode .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}body.dark-mode{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body.dark-mode .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media screen and (prefers-color-scheme: light){body{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0, 0, 0, 0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg)}body .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}}@media screen and (prefers-color-scheme: dark){body{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.tippy-content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}}html{--font-family: system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, Arial, sans-serif;--font-family-heading: system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, Arial, sans-serif;--code-font-family: ui-monospace, Menlo, Monaco, Cascadia Mono, Segoe UI Mono, Roboto Mono, Oxygen Mono, Ubuntu Mono, Source Code Pro, Fira Mono, Droid Sans Mono, Consolas, Courier New, monospace;--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 900;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 104rem}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem;margin-bottom:1.5rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f6,h6,.h6,.f5,h5,.h5,.f4,.sidebar-nav-item,h4,.h4,.post-date,.f3,h3,.h3,.f2,h2,.h2,.f1,h1,.h1{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,.sidebar-nav-item,h4,.h4,.post-date{font-size:1.08rem;line-height:1.6}.f5,h5,.h5{font-size:1.04rem;line-height:1.7}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 104rem){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:4rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:4rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:3rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:2rem}@media screen and (min-width: 104rem){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:flex;justify-content:space-between;margin-top:-0.6rem;height:2rem;margin-bottom:.85rem;color:var(--gray)}.post-date>.ellipsis,#breadcrumbs.post-date>ul{cursor:pointer}.post-date [class^=icon-]{display:inline-block;font-size:smaller;margin-right:.25rem}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,#markdown-toc,.note{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,#markdown-toc,.note{background:rgba(0,0,0,0);color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.2rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,#markdown-toc:before,.note:before{font-size:.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,[title]#markdown-toc:before,[title].note:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:"";width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media(min-width: 64em){body::before{width:21rem}}@media(min-width: 104rem){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}#breadcrumbs>ul{height:1rem;margin:-1.5rem 0 .5rem;padding:0;font-size:.667rem;color:var(--menu-text);text-transform:uppercase;width:100%;list-style:none}#breadcrumbs>ul>li{display:inline}#breadcrumbs>ul>li a{color:var(--gray);text-decoration:none;border-bottom:none}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.ml1{margin-left:1rem}.mr1{margin-right:1rem}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.larger{font-size:larger}.smaller{font-size:smaller}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.ellipsis,#breadcrumbs>ul{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border{border:1px solid var(--border-color)}@media(min-width: 42em){.border-radius,.lead,.page .aspect-ratio.sixteen-nine.lead{border-radius:.5rem}}.fallback-img{background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports(text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}@supports(text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 104rem){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,.75);text-align:center;min-height:100vh}.sidebar.invert{color:rgba(32,32,32,.75)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,.2);text-decoration-color:rgba(255,255,255,.2)}.sidebar.invert a{color:#222;border-bottom-color:rgba(32,32,32,.2);text-decoration-color:rgba(32,32,32,.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center/cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32, 32, 32, 0) 0%, rgba(32, 32, 32, 0.5) 50%, rgba(32, 32, 32, 0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:"";display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar.invert .sidebar-about>a.sidebar-title::after{border-color:rgba(32,32,32,.2)}.sidebar.invert .sidebar-about>a.sidebar-title:hover::after{border-color:#222}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media(min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-bottom,.fixed-top{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:#fff;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 104rem){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:20.5rem;right:0;margin:auto;overflow:auto}}@media screen and (min-width: 104rem){body.no-break-layout:not(.no-toc) #markdown-toc{width:calc(50% - 31rem)}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;min-height:100vh}}@media screen and (min-width: 42em){.content{max-width:42rem}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{padding-top:9rem;margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 104rem){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 104rem){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"}</style><link rel="preload" as="style" href="/assets/css/hydejack-9.2.1.css" id="_stylePreload"><link rel="preload" as="style" href="/assets/icomoon/style.css" id="_iconsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/ </script> <noscript><link rel="stylesheet" href="/assets/css/hydejack-9.2.1.css"><link rel="stylesheet" href="/assets/icomoon/style.css"> </noscript><style id="_pageStyle"> html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79, 177, 186, 0.5);--accent-color-highlight: rgba(79, 177, 186, 0.1);--accent-color-darkened: #409ba3;--theme-color: rgb(25,55,71);--dark-mode-body-bg: hsl(200.8695652174, 5.9895833333%, 17.5%);--dark-mode-border-color: hsl(200.8695652174, 5.9895833333%, 22.5%)}</style><!--<![endif]--><body class="no-break-layout"> <script> window._sunrise = 6; window._sunset = 18; ((e,s)=>{var d="light-mode",a="dark-mode",o=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(e=(o=o<=e._sunrise||o>=e._sunset?a:d)==a?d:a,s.body.classList.add(o),s.body.classList.remove(e))})(window,document); </script> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange > <hy-drawer id="_drawer" class="cover" side="left" threshold="10" noscroll opened ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(25,55,71);background-image:url(/assets/img/sidebar-bg.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/" tabindex="-1">   <hy-img root-margin="512px"  src="/assets/icons/icon.png" class="avatar" alt="Andreas Volkmann" width="120" height="120" loading="lazy" >    <noscript><img data-ignore  src="/assets/icons/icon.png" class="avatar" alt="Andreas Volkmann" width="120" height="120" loading="lazy" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> </a> <a class="sidebar-title" href="/"><h2 class="h1">Andreas Volkmann</h2></a><p class=""> Personal page.</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_drawer--opened" href="/posts/" class="sidebar-nav-item " > Blog </a><li> <a href="/onsen/" class="sidebar-nav-item " > Onsen </a><li> <a href="/software/" class="sidebar-nav-item " > Software </a><li> <a href="/about/" class="sidebar-nav-item " > About </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://github.com/AndreasVolkmann" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="https://play.spotify.com/user/113258637" title="Spotify" class="no-mark-external"> <span class="icon-spotify"></span> <span class="sr-only">Spotify</span> </a><li> <a href="https://soundcloud.com/shin-kudo" title="SoundCloud" class="no-mark-external"> <span class="icon-soundcloud"></span> <span class="sr-only">SoundCloud</span> </a><li> <a href="http://www.last.fm/user/shadowgonzo" title="Last.fm" class="no-mark-external"> <span class="icon-lastfm"></span> <span class="sr-only">Last.fm</span> </a><li> <a href="http://stackoverflow.com/users/5335131/andreas-volkmann" title="Stack Overflow" class="no-mark-external"> <span class="icon-stackoverflow"></span> <span class="sr-only">Stack Overflow</span> </a><li> <a href="https://www.linkedin.com/in/andreas-volkmann-a5553a106" title="LinkedIn" class="no-mark-external"> <span class="icon-linkedin2"></span> <span class="sr-only">LinkedIn</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-blog" role="main" ><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><article id="post-blog-onsen-yunnan-onsen" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/onsen/2025-04-30-yunnan-onsen/" class="flip-title"> ♨️ Onsen - Yunnan </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2025-04-30T00:00:00-07:00">30 Apr 2025</time> in <span>Blog</span> / <a href="/onsen/" class="flip-title">Onsen</a> </span></div><a href="/blog/onsen/2025-04-30-yunnan-onsen/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="img-wrapper lead aspect-ratio sixteen-nine flip-project-img">   <hy-img root-margin="512px"  src="/assets/img/yunnan/bridge.jpg" alt="♨️ Onsen - Yunnan" width="864" height="486" loading="lazy" >    <noscript><img data-ignore  src="/assets/img/yunnan/bridge.jpg" alt="♨️ Onsen - Yunnan" width="864" height="486" loading="lazy" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img></div></a><p class="note-sm" > An unexpectedly onsen experience in mysterious Yunnan</header><ol id="markdown-toc"><li><a href="#angsana" id="markdown-toc-angsana">Angsana</a><li><a href="#huangguajing" id="markdown-toc-huangguajing">HuangguaJing</a><li><a href="#rehai" id="markdown-toc-rehai">Rehai</a><li><a href="#local-onsen" id="markdown-toc-local-onsen">Local Onsen</a><li><a href="#outside-tengchong" id="markdown-toc-outside-tengchong">Outside Tengchong</a><li><a href="#food" id="markdown-toc-food">Food</a></ol><p>Yunnan is colorful, vibrant, and very different from what most people imagine when they think of China.<p>I was surprised by how little information is accessible about this region, especially when it comes to onsen.<p>The Tengchong area has a ton of interesting hot springs in different styles: traditional, spa-style, decorative, and open-pool-style.<p>I recommend Heshun as a base, situated between many hot springs. Many houses, including the one I stayed in, have onsen water in their bath.<p>The area is full of mountains, lakes, rivers, making for amazing views. This one is taken close to Simolawa village:   <hy-img root-margin="512px"  src="/assets/img/yunnan/fengjing.png" alt="view near Simolawa" >    <noscript><img data-ignore  src="/assets/img/yunnan/fengjing.png" alt="view near Simolawa" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><h2 id="angsana">Angsana</h2><p>One of the spa hotels in the area with a large selection of outdoor pools. They have a wide temperature selection, making it a good choice for beginners. Unfortunately, only a few pools are around 41-42 degrees.<p><a href="https://www.angsana.com/china/tengchong">Angsana website</a><p>  <hy-img root-margin="512px"  src="/assets/img/yunnan/angsana.png" alt="pools in agsana" >    <noscript><img data-ignore  src="/assets/img/yunnan/angsana.png" alt="pools in agsana" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img>   <hy-img root-margin="512px"  src="/assets/img/yunnan/angsana_2.png" alt="pools in agsana" >    <noscript><img data-ignore  src="/assets/img/yunnan/angsana_2.png" alt="pools in agsana" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>Here is the water quality report from the hotel.   <hy-img root-margin="512px"  src="/assets/img/yunnan/shui_zhiliang.png" alt="Water quality" >    <noscript><img data-ignore  src="/assets/img/yunnan/shui_zhiliang.png" alt="Water quality" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> This is bicarbonate water.<p>Another similar onsen hotel we visited is “the Lotus” or Hehua (荷花温泉). Hardly any presence in English, but this is it: <a href="https://www.trip.com/travel-guide/attraction/lianghe/hehua-hot-spring-10759140/">Lotus onsen</a><h2 id="huangguajing">HuangguaJing</h2><p>Huangguajing has the hottest water (&gt;43) and overall the most authentic experience without the “spa” atmosphere.   <hy-img root-margin="512px"  src="/assets/img/yunnan/huangguajing.png" alt="onsen in hotel" >    <noscript><img data-ignore  src="/assets/img/yunnan/huangguajing.png" alt="onsen in hotel" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>It’s small and very crowded, which can impact the experience a bit.<h2 id="rehai">Rehai</h2><p>Rehai has a bit of Beppu with the many decorative pools.   <hy-img root-margin="512px"  src="/assets/img/yunnan/rehai.png" alt="view" >    <noscript><img data-ignore  src="/assets/img/yunnan/rehai.png" alt="view" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> It’s a nice, scenic path from the shuttle to the onsen.<h2 id="local-onsen">Local Onsen</h2><p>This onsen has no presence online, as far as I can tell. It’s near the road, easy to miss if you don’t know where to look.<p>It features several foot onsen, as well as large pools.   <hy-img root-margin="512px"  src="/assets/img/yunnan/pool.png" alt="view" >    <noscript><img data-ignore  src="/assets/img/yunnan/pool.png" alt="view" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>I like the variety that onsen pools offer, as it’s super comfortable take a swim in them.<p>The sunset here was amazing.<p>This is definitely more of a local spot, so I am happy I got to experience it.<h2 id="outside-tengchong">Outside Tengchong</h2><p>I also visited some onsen outside Tengchong, like Reguo (热国) near Dali. If you’re in the area, it’s worth checking out.<h2 id="food">Food</h2><p>Lastly, Yunnan’s got it all. Amazing food, fruit, coffee, and tea (the local tea is called Dianhong 滇红).   <hy-img root-margin="512px"  src="/assets/img/yunnan/food.jpg" alt="food" >    <noscript><img data-ignore  src="/assets/img/yunnan/food.jpg" alt="food" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> The cuisine has strong influences from neighboring Thailand and Myanmar, often incorporating fruit. I am especially fond of anything with passion fruit. I had both a hotpot with passion fruit in the soup, and amazing local tomatoes with passion fruit dressing.<p>  <hy-img root-margin="512px"  src="/assets/img/yunnan/shuiguo.png" alt="local fruit" >    <noscript><img data-ignore  src="/assets/img/yunnan/shuiguo.png" alt="local fruit" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> There are some fruits here that I have never tried before, and unfortunately don’t know the name right now.<p>We checked out one of the coffee plantations.   <hy-img root-margin="512px"  src="/assets/img/yunnan/coffee.png" alt="coffee" >    <noscript><img data-ignore  src="/assets/img/yunnan/coffee.png" alt="coffee" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> I really enjoyed the local coffee and the surrounding culture. It reminds me a bit of Italy.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/onsen/2025-04-30-yunnan-onsen/">♨️ Onsen - Yunnan</a></footer></article><article id="post-blog-software-flow-perf-csv-to-json" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2025-04-19-flow-perf-csv-to-json/" class="flip-title"> ⚡ Power Automate - Efficient CSV to JSON </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2025-04-19T00:00:00-07:00">19 Apr 2025</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 30 Apr 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-04-30T19:24:31-07:00">2025-04-30</time> </span></div><p class="note-sm" > Recently had to convert a CSV file to JSON in a Power Automate Flow and found that all existing articles on this are using inefficient loops</header><ol id="markdown-toc"><li><a href="#split-lines" id="markdown-toc-split-lines">Split Lines</a><li><a href="#split-rows" id="markdown-toc-split-rows">Split Rows</a><li><a href="#map-to-object" id="markdown-toc-map-to-object">Map to Object</a><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><p>I recently was looking at converting CSV content to JSON in a Power Automate Flow in order to be able to work with it.<p>Existing articles on this topic seem to all be using inefficient loops so I decided to provide an example of an efficient Data Operations implementation.<p>The overall flow looks like this:<p>  <hy-img root-margin="512px"  src="/assets/img/flow_csv-to-json_overview.png" alt="Flow CSV to JSON" >    <noscript><img data-ignore  src="/assets/img/flow_csv-to-json_overview.png" alt="Flow CSV to JSON" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>High level overview:<ol><li>HTTP call gets the CSV file content<li>Compose to split the lines into an array<li>Select to split the rows into an array<li>Select to map the rows to objects<li>Filter as an example on how to further process the objects</ol><h2 id="split-lines">Split Lines</h2><p>Type: Compose<p>Takes a single CSV string and splits it by new-line into an array of strings<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">skip</span><span class="o">(</span><span class="n">split</span><span class="o">(</span><span class="n">trim</span><span class="o">(</span><span class="n">body</span><span class="o">(</span><span class="err">'</span><span class="no">HTTP</span><span class="err">'</span><span class="o">)),</span> <span class="n">decodeUriComponent</span><span class="o">(</span><span class="err">'</span><span class="o">%</span><span class="mi">0</span><span class="no">D</span><span class="o">%</span><span class="mi">0</span><span class="no">A</span><span class="err">'</span><span class="o">)),</span> <span class="mi">1</span><span class="o">)</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">skip(1)</code> to drop the header<p><code class="language-plaintext highlighter-rouge">trim</code> to get rid of empty lines<p><code class="language-plaintext highlighter-rouge">decodeUriComponent('%0D%0A')</code> represents the new-line character<h2 id="split-rows">Split Rows</h2><p>Type: Select<p>Takes an array of strings and splits them by comma into an array of arrays of strings.<p>  <hy-img root-margin="512px"  src="/assets/img/flow_csv-to-json_split-rows.png" alt="Split Rows" >    <noscript><img data-ignore  src="/assets/img/flow_csv-to-json_split-rows.png" alt="Split Rows" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">split</span><span class="o">(</span><span class="n">item</span><span class="o">(),</span> <span class="sc">','</span><span class="o">)</span>
</code></pre></div></div><h2 id="map-to-object">Map to Object</h2><p>Type: Select<p>We unwrap each nested array into actual objects<p>For each column, assign <code class="language-plaintext highlighter-rouge">item()?[0]</code> with the corresponding index<p>  <hy-img root-margin="512px"  src="/assets/img/flow_csv-to-json_map-objects.png" alt="Map to Object" >    <noscript><img data-ignore  src="/assets/img/flow_csv-to-json_map-objects.png" alt="Map to Object" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>The final output will be an array of objects:<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"DateModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3/25/2025"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div><h1 id="conclusion">Conclusion</h1><p>This is an efficient way to convert CSV to JSON in Power Automate Flow.<p>The key is to use Data Operations instead of Control Loops.<p>Looping over even small collections will take seconds as opposed to near-instant data operations.<p>For more see <a href="/blog/2022-04-09-dataverse-perf-flow-loops">Dataverse Performance - Flow Iteration</a><footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2025-04-19-flow-perf-csv-to-json/">⚡ Power Automate - Efficient CSV to JSON</a></footer></article><article id="post-blog-software-first-agent" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2024-07-22-first-agent/" class="flip-title"> ⚗️ Learning from Agents </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2024-07-22T00:00:00-07:00">22 Jul 2024</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 30 Apr 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-04-30T19:24:31-07:00">2025-04-30</time> </span></div><p class="note-sm" > LLMs round 2 - lessons learned from working with agents</header><ol id="markdown-toc"><li><a href="#less-is-more" id="markdown-toc-less-is-more">Less is more</a><li><a href="#context-is-everything" id="markdown-toc-context-is-everything">Context is everything</a><li><a href="#every-token-matters" id="markdown-toc-every-token-matters">Every token matters</a><li><a href="#over-anthropomorphization" id="markdown-toc-over-anthropomorphization">Over-Anthropomorphization</a><li><a href="#best-practices-still-apply" id="markdown-toc-best-practices-still-apply">Best practices still apply</a><li><a href="#hoping-for-better-models" id="markdown-toc-hoping-for-better-models">Hoping for better models</a></ol><p>It’s been some time since <a href="/blog/2023-10-07-first-prompt">my initial impression post on LLMs</a>, and since I’ve recently had an opportunity to gather my thoughts, I wanted to also summarize them here so that I can come back and see how they changed over time.<p>The following are rough notes of lessons learned from working with LLMs and the Agent concept.<h1 id="less-is-more">Less is more</h1><ul><li>Usually to improve quality, we take away, rather than adding more<li>This means distill your prompts and systems as much as possible</ul><blockquote><p>As you distill your ideas, they naturally improve, because when you drop the merely good parts, the great parts can shine more brightly.</blockquote><ul><li>It’s easy to overdo it with premature planning, fine-tuning, and RAG<li>Until there is proven value from such efforts, better to keep it simple</ul><h1 id="context-is-everything">Context is everything</h1><ul><li>Agents are tool-driven. Without tools, they cannot do anything and even if you had a super advanced orchestration loop, it wouldn’t help.<li>High quality tools are the bread and butter of effective agents<li>Emulate a real chat. All context interactions have to account for the fact that models are trained on chat and work best with realistic chat messages.<li>As an example, some tools might produce no output, which is an open invitation to hallucinate. Handle special cases so that they produce a coherent chat history.</ul><h1 id="every-token-matters">Every token matters</h1><ul><li>Some time ago, we expected that as models got better, they would be less sensitive to minor token variations in prompts.<li>It doesn’t seem like this problem has solved itself yet. We still encounter cases where single tokens make or break a scenario. As an example, the difference between singular and plural <code class="language-plaintext highlighter-rouge">Contact</code> -&gt; <code class="language-plaintext highlighter-rouge">Contacts</code> is enough to produce the wrong table name in tests.<li>Reduce the noise - Any token can potentially throw off the LLM<ul><li>As before, you will want to triple check every single token that makes it into your context, and only include those that add value.<li>Make sure your prompts are as distilled and concise as possible. Adopt a zero-tolerance stance towards grammar mistakes and typos.</ul><li>LLMs increasingly depend on free-text data like names and descriptions. Ensure this data is of high semantic quality, and not too complex.<li>Rule of thumb: If it doesn’t make sense to you, it won’t work for the LLM.<li>This may also apply to localizations!<li>Allow the LLM to focus on what it’s good at<ul><li>If possible define data at design time rather than relying on LLM to re-generate Guids, etc.</ul></ul><h1 id="over-anthropomorphization">Over-Anthropomorphization</h1><ul><li>The language used to describe LLM-backed products is too close to human semantics<li>This leads to expectations that go beyond merely predicting the next token<li>We tend to use human verbs like think, know.<li>Agent is a bad term that inspires human analogies. An alternative is to consistently use bot or LLM-bot instead as this more clearly communicates expectations to users.<li>There is no brain / memory / thought / knowledge.<li>Simply put, if critical data is missing from the context, then it is very unlikely that the LLM will predict the correct tokens.<li><a href="https://jurgengravestein.substack.com/p/the-intelligence-paradox">The Intelligence Paradox - by Jurgen Gravestein (substack.com)</a></ul><h1 id="best-practices-still-apply">Best practices still apply</h1><ul><li>This is still just software. All previous best practices apply.<li>Most importantly: Write tests / eval / benchmark.<li>LLM features without tests are like black boxes (same as any software really)<li>You cannot improve what you cannot measure<li>I recommend to do as always:<ul><li>Iterate with unit tests, incrementally improve with feedback<li>Some tests are better than none<li>Be smart about what to test. Find test cases that provide relatively stable expectations, but represent a distinct behavior.</ul></ul><h1 id="hoping-for-better-models">Hoping for better models</h1><ul><li>Or: The one model to rule them all<li>Some time ago a belief emerged that future models would solve prevalent issues with LLMs<li><a href="https://crfm.stanford.edu/helm/lite/latest/">Holistic Evaluation of Language Models (HELM) (stanford.edu)</a><li>While GPT-4o does seem to be the best model on average, it is not significantly outperforming GPT-4 (0613), which at this point is over a year old.<li>Think back one year and what expectations we had back then for where we would be by now. Given how quickly GPT 3.5 and 4 dropped, people were led to believe that we would have some truly amazing next version by mid-2024.<li>New models are different, not just better<ul><li>While we did get many new models (gpt 4 turbo and now 4o), it’s not entirely clear whether they are improvements across the board<li>Ultimately there hasn’t been any groundbreaking improvement in LLM output quality since GPT 4.</ul><li>Eventually GPT-5. But at what cost?   <hy-img root-margin="512px"  src="/assets/img/gpt5whale.jpeg" alt="GPT-5" >    <noscript><img data-ignore  src="/assets/img/gpt5whale.jpeg" alt="GPT-5" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><ul><li>Realism comes at the cost of coverage<li><a href="https://gorilla.cs.berkeley.edu/leaderboard.html#:~:text=The%20Berkeley%20Function%20Calling%20Leaderboard,and%20will%20be%20updated%20periodically.">Berkeley Function Calling Leaderboard (aka Berkeley Tool Calling Leaderboard)</a><li>LLM systems are more than their largest model<li>While we can expect to eventually get GPT 5 or the like (much better?), we are still constrained by COGS, which are likely higher. So we may want to explore SMLs, etc., and alternative approaches to improve<li>SLMs getting good at specific tasks. JIT model selection may help balance cost / quality. See <a href="https://github.com/lm-sys/RouteLLM">GitHub - lm-sys/RouteLLM: A framework for serving and evaluating LLM routers - save LLM costs without compromising quality!</a></ul></ul><p>Those are my current thoughts. Excited to see how they will have changed in 6 months - 1 year’s time!<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2024-07-22-first-agent/">⚗️ Learning from Agents</a></footer></article><article id="post-blog-onsen-onsen-city" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/onsen/2024-04-28-onsen-city/" class="flip-title"> ♨️ Onsen City </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2024-04-28T00:00:00-07:00">28 Apr 2024</time> in <span>Blog</span> / <a href="/onsen/" class="flip-title">Onsen</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 30 Apr 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-04-30T19:05:48-07:00">2025-04-30</time> </span></div><a href="/blog/onsen/2024-04-28-onsen-city/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="img-wrapper lead aspect-ratio sixteen-nine flip-project-img">   <hy-img root-margin="512px"  src="/assets/img/onsen_beppu.jpg" alt="♨️ Onsen City" width="864" height="486" loading="lazy" >    <noscript><img data-ignore  src="/assets/img/onsen_beppu.jpg" alt="♨️ Onsen City" width="864" height="486" loading="lazy" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img></div></a><p class="note-sm" > An entire city of onsen exceeding expectations</header><ol id="markdown-toc"><li><a href="#yuyama-no-sato-湯山の里" id="markdown-toc-yuyama-no-sato-湯山の里">Yuyama no Sato 湯山の里</a><li><a href="#ebisu-湯屋えびす" id="markdown-toc-ebisu-湯屋えびす">Ebisu 湯屋えびす</a><li><a href="#nabeyama-鍋山の湯" id="markdown-toc-nabeyama-鍋山の湯">Nabeyama 鍋山の湯</a><li><a href="#kannawa-鉄輪温泉" id="markdown-toc-kannawa-鉄輪温泉">Kannawa 鉄輪温泉</a><li><a href="#shibaseki-紫関温泉" id="markdown-toc-shibaseki-紫関温泉">Shibaseki 紫関温泉</a><li><a href="#suginoi-area" id="markdown-toc-suginoi-area">Suginoi area</a><ol><li><a href="#horita-堀田温泉" id="markdown-toc-horita-堀田温泉">Horita 堀田温泉</a><li><a href="#mugen-no-sato-夢幻の里" id="markdown-toc-mugen-no-sato-夢幻の里">Mugen no Sato 夢幻の里</a><li><a href="#suginoi-hotel-杉乃井ホテル" id="markdown-toc-suginoi-hotel-杉乃井ホテル">Suginoi Hotel 杉乃井ホテル</a></ol></ol><p>Finally made it to Beppu, AKA Onsen City!<p>Initially, I was doubtful whether this was the best choice for a great Onsen experience in Japan.<p>Most reports I read didn’t praise it too highly and generally dedicated little time to it.<p>Beppu turned out to be my favorite place this time and I ended up pulling in extra days to extend my stay here.<p>I highly recommend going if you enjoy onsen, as there is a lot of variety, and it’s a great place to relax.<p>I’ll showcase a few of my favorite places below.<h1 id="yuyama-no-sato-湯山の里">Yuyama no Sato 湯山の里</h1><p>This onsen village lies just behind Myoban (明礬), so I kind of count it into the same area.<p>After a quick checkin with the owner, who built the entire place himself, there’s a small 5 min hike through a small bamboo forest, down to then onsen.<p>Since we didn’t meet anyone else here, this would be my secret tip.<p>  <hy-img root-margin="512px"  src="/assets/img/yuyama.png" alt="Yuyama Main Bath" >    <noscript><img data-ignore  src="/assets/img/yuyama.png" alt="Yuyama Main Bath" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>  <hy-img root-margin="512px"  src="/assets/img/yuyama_2.png" alt="Yuyama waterfall" >    <noscript><img data-ignore  src="/assets/img/yuyama_2.png" alt="Yuyama waterfall" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>  <hy-img root-margin="512px"  src="/assets/img/yuyama_3.png" alt="Yuyama river" >    <noscript><img data-ignore  src="/assets/img/yuyama_3.png" alt="Yuyama river" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>There is an abundance of different pools, with the temperature on the hotter side.<h1 id="ebisu-湯屋えびす">Ebisu 湯屋えびす</h1><p>Located in Myoban (明礬). They have both shared and private baths.<p>  <hy-img root-margin="512px"  src="/assets/img/ebisu_1.png" alt="Ebisu" >    <noscript><img data-ignore  src="/assets/img/ebisu_1.png" alt="Ebisu" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img>   <hy-img root-margin="512px"  src="/assets/img/ebisu_2.png" alt="Ebisu geranium" >    <noscript><img data-ignore  src="/assets/img/ebisu_2.png" alt="Ebisu geranium" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img>   <hy-img root-margin="512px"  src="/assets/img/ebisu_3.png" alt="Ebisu outdoor" >    <noscript><img data-ignore  src="/assets/img/ebisu_3.png" alt="Ebisu outdoor" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img>   <hy-img root-margin="512px"  src="/assets/img/ebisu_4.png" alt="Ebisu private" >    <noscript><img data-ignore  src="/assets/img/ebisu_4.png" alt="Ebisu private" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><h1 id="nabeyama-鍋山の湯">Nabeyama 鍋山の湯</h1><p>There are a few free onsen pools in the mountains a small hike away from Myoban (明礬).<p>The water wasn’t quite warm enough when I got there, so it can be hit or miss, but the hike is nice and the views good, too.<h1 id="kannawa-鉄輪温泉">Kannawa 鉄輪温泉</h1><p>Cozy little district with steam coming out of the ground everywhere.<p>Cats chilling, sometimes hiding their head in a crack in the ground to keep warm.<p>Tons of small ~100¥ Onsen which make it fun to hop from one to the other.<h1 id="shibaseki-紫関温泉">Shibaseki 紫関温泉</h1><p>Don’t have any pictures of this one, but very worth a visit.<p>They have a very hot indoor pool, a relaxing outdoor pool, and an amazing sauna!<p>The locals are super fun here :)<h1 id="suginoi-area">Suginoi area</h1><p>This refers to the south-western part of Beppu, where the Suginoi Hotel is located.<p>Since these places are closely located, I group them under this moniker.<h2 id="horita-堀田温泉">Horita 堀田温泉</h2><p>  <hy-img root-margin="512px"  src="/assets/img/horita.png" alt="Horita Men's bath" >    <noscript><img data-ignore  src="/assets/img/horita.png" alt="Horita Men's bath" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><h2 id="mugen-no-sato-夢幻の里">Mugen no Sato 夢幻の里</h2><p>Consists of multiple private onsen, which you can rent for 1h for very little money (I think 1000?).<p>  <hy-img root-margin="512px"  src="/assets/img/mugen-no-sato-yu.png" alt="Mugen no Sato private bath" >    <noscript><img data-ignore  src="/assets/img/mugen-no-sato-yu.png" alt="Mugen no Sato private bath" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>You can also steam your own food here, using the steam from the water.<p>  <hy-img root-margin="512px"  src="/assets/img/mugen-no-sato-mushi.png" alt="Mugen no Sato steam cooking area" >    <noscript><img data-ignore  src="/assets/img/mugen-no-sato-mushi.png" alt="Mugen no Sato steam cooking area" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>Recommend to capitalize on this and bring lots of raw ingredients.<p>Things like Kabocha turn out great.<h2 id="suginoi-hotel-杉乃井ホテル">Suginoi Hotel 杉乃井ホテル</h2><p>This hotel has a rooftop outdoor pool area for swimming (heated) and an onsen area with amazing views over the Beppu bay.<p>Suggest to time your visit for sunset and enjoy the evening here.<p>  <hy-img root-margin="512px"  src="/assets/img/suginoi_1.avif" alt="Suginoi Onsen" >    <noscript><img data-ignore  src="/assets/img/suginoi_1.avif" alt="Suginoi Onsen" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>  <hy-img root-margin="512px"  src="/assets/img/suginoi_2.jpg" alt="Suginoi Swimming Pools" >    <noscript><img data-ignore  src="/assets/img/suginoi_2.jpg" alt="Suginoi Swimming Pools" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><hr /><p>For more Onsen, see <a href="/blog/2022-10-30-onsen">some of my favorite hot springs</a>.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/onsen/2024-04-28-onsen-city/">♨️ Onsen City</a></footer></article><article id="post-blog-software-first-prompt" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2023-10-07-first-prompt/" class="flip-title"> ⚗️ Distilled knowledge </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2023-10-07T00:00:00-07:00">07 Oct 2023</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 30 Apr 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-04-30T19:24:31-07:00">2025-04-30</time> </span></div><p class="note-sm" > To attain knowledge, add things every day. To attain wisdom, remove things every day. (<em>Laozi</em>)</header><ol id="markdown-toc"><li><a href="#the-intersection-of-programming-and-language" id="markdown-toc-the-intersection-of-programming-and-language">The intersection of programming and language</a><li><a href="#distilling-prompts" id="markdown-toc-distilling-prompts">Distilling prompts</a><ol><li><a href="#less-is-more" id="markdown-toc-less-is-more">Less is more</a><li><a href="#forcing-the-model-" id="markdown-toc-forcing-the-model-">Forcing the model …</a><li><a href="#native-code-intuition" id="markdown-toc-native-code-intuition">Native code intuition</a></ol><li><a href="#language-efficiency" id="markdown-toc-language-efficiency">Language efficiency</a><li><a href="#outro" id="markdown-toc-outro">Outro</a></ol><p>For this post I want to record some of my first impressions of LLMs and prompting, as well as some of the insights I believe to have gained. It will be interesting to revisit this later on and see how it held up.<h2 id="the-intersection-of-programming-and-language">The intersection of programming and language</h2><p>I anticipate a new paradigm at the intersection of programming and language understanding.<p>LLMs are now capable enough so that software engineers can take off-the-shelf models and build applications with them. In order to instruct the model, prompts are written in natural language, just like the outputs. The hurdle of data science is no longer.<p>Anyone can write such prompts, but to truly develop reliable, effective prompts, it seems to me one has to develop an understanding and intuition about the way the LLM speaks and comprehends language.<p>At the same time, it’s not enough to just be good at prompting. One also needs a methodical approach to evaluate the results of the model. This is where programming concepts like unit testing come in handy. If you want to take your prompts to the next level, find a metric that measures the output quality, then apply TDD (Test Driven Development) to push the prompt to its limits, by continuously testing and refining.<p>This is already being done at the model level, yielding the below chart, which can help visualize the strengths &amp; weaknesses of each model. <a href="https://browse.arxiv.org/pdf/2309.16583.pdf">  <hy-img root-margin="512px"  src="/assets/img/llm_model_strength_weakness.png" alt="Model Strengths &amp; Weaknesses" >    <noscript><img data-ignore  src="/assets/img/llm_model_strength_weakness.png" alt="Model Strengths &amp; Weaknesses" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img></a><p>Once you’ve tried to combine plain programming with LLM prompts, you might agree with me that this is the next big step for our industry.<p>I recommend <a href="https://open.spotify.com/episode/3MK8V1DbT7d5YEBlrdbBdQ">this Latent Space episode</a>, which coins the term AI Engineer to define software engineers moving closer to the ML space to get enough proficiency to effectively apply LLMs to produce new applications.<h2 id="distilling-prompts">Distilling prompts</h2><p>The art of prompting is still in its infancy and no exact science. I don’t claim to have all the answers, but the following has worked well for me.<blockquote><ul><li>Most of this applies to GPT 3.5 0613<li>Primarily targeting Reductive Operations, such as Summarization and Extraction</ul></blockquote><p>When writing prompts, I have observed the following tendencies.<h3 id="less-is-more">Less is more</h3><blockquote><p>You are like this tea cup, so full that nothing more can be added. Come back to me when the cup is empty. Come back to me with an empty mind.<p><em>Laozi</em></blockquote><p>Being overly prescriptive, wordy, and detailed.<p>Lots of rules, and when something doesn’t quite turn out how we want it to, we add another special case sentence. The prompt ends up overloaded so that any single change, formatting or content, breaks it. In such cases it is better to go back to zero, and come back witn an empty mind / prompt.<p>Try to distill your prompt down to the most essential meaning. Every single word in your prompt matters, and there should be a reason for why you include it.<p>Just like we do with language and code, in order to really convey our intent, we distill our prompt down to its essence.<blockquote><p>Distillation is at the very heart of all effective communication. The more important it is that your audience hear and take action on your message, the more distilled that message needs to be.<p><em>Building a Second Brain by Tiago Forte</em></blockquote><p>Lastly, it’s worth noting that the same meaning phrased differently can lead to radically different results. So rather than throw more words at it, I prefer to find few words which trigger the right response.<h3 id="forcing-the-model-">Forcing the model …</h3><p>… to do something it isn’t good at.<p>Outputting JSON or producing answers that require non-language thinking.<p>Instead of trying to control the output with rules and confusing the model with complex instructions where even we have to think, I found that starting out with a highly distilled version (as little as a single sentence) can shed some light on what the model is good at natively.<p>So rather than trying to bend the model to your will, try to <em>cooperate</em>!<p>I found that oftentimes you don’t have to instruct 3.5 about the output format at all. It tends to produce colon-delimited key-value pairs if only you change your wording slightly. <code class="language-plaintext highlighter-rouge">Provide X, Y, Z ...</code> seems to work well, where XYZ are properties that start with a captial letter.<p>You can save yourself lots of trouble by simply going with the flow of whatever the LLM is comfortable with.<h3 id="native-code-intuition">Native code intuition</h3><p>GPT 3.5 seems to have very good intuition about coding concepts. As software engineers, this gives us superpowers, as we can boil down complex intent into sometimes single characters.<p>As an example, if you use extraction prompts like the above, you can easily communicate that you want certain properties to be nullable/optional: <code class="language-plaintext highlighter-rouge">Provide X, Y?, Z ...</code>. Just by appending <code class="language-plaintext highlighter-rouge">?</code> to the property, the model will often prefer to omit rather than invent outputs.<h2 id="language-efficiency">Language efficiency</h2><p>One other thing I observed is that English is a pretty good language for prompts. Usually one of the drawbacks of English is that it requires a lot of characters compared to languages like Chinese.<p>Twitter used to have a really low character limit per tweet, which was easily consumed in “western” languages. Character-based writing systems can simply fit more meaning into a single tweet. It’s part of the reason why <a href="https://fortune.com/2022/11/23/elon-musk-twitter-japan-users-layoffs-moderation/">Musk stated that Twitter’s ideal market isn’t the U.S.—it’s Japan</a> (behind paywall but you can sidestep with reader). I explore some of the reasons why Japanese is more concise in <a href="/blog/2021-07-25-topic-markers-in-language-design">Language features across the boundary</a>.<p>However, what matters in prompts are tokens, not characters, and from my experience the tokenization of English is quite efficient. A lot of words are encoded as a single token, which means they can compete with Chinese characters. <a href="https://platform.openai.com/tokenizer">  <hy-img root-margin="512px"  src="/assets/img/gpt_tokenizer.png" alt="GPT Tokenizer" >    <noscript><img data-ignore  src="/assets/img/gpt_tokenizer.png" alt="GPT Tokenizer" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img></a><h2 id="outro">Outro</h2><p>The above is just a snapshot of my current ideas. Excited to see where things are at in a few months. Currently reading <a href="https://www.goodreads.com/book/show/59616977-building-a-second-brain">Building a Second Brain by Tiago Forte</a>, and it is amazing how much of it applies to LLMs / prompting.<blockquote><p>[…] if you’re stuck on a task, break it down into smaller steps.</blockquote><p>This aligns with <a href="https://arxiv.org/abs/2201.11903">the Chain-of-Thought principle</a> for prompts.<blockquote><p>As you distill your ideas, they naturally improve, because when you drop the merely good parts, the great parts can shine more brightly.</blockquote><p>Similar to what I wrote about distillation above.<p>Lastly, I found this example from the book very interesting:<blockquote><p>Coppola’s strategy for making the complex, multifaceted film rested on a technique he learned studying theater at Hofstra College, known as a “<strong>prompt book</strong>.”<p>Coppola considered the prompt book that emerged from this process the most important asset in the production of his now classic film: “the script was really an unnecessary document; I didn’t need a script because I could have made the movie just from this notebook.”</blockquote><p>Basically <a href="https://en.wikipedia.org/wiki/Francis_Ford_Coppola">Coppola</a> was prompting himself with this book, which enabled him to produce The Godfather without the full script. Sounds like he had enough training data :)<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2023-10-07-first-prompt/">⚗️ Distilled knowledge</a></footer></article><article id="post-blog-software-dry-srp-caching" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2023-02-12-dry-srp-caching/" class="flip-title"> 🎨 DRY the paint on your Cross Cutting Concerns </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2023-02-12T00:00:00-08:00">12 Feb 2023</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 30 Apr 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-04-30T19:23:17-07:00">2025-04-30</time> </span></div><p class="note-sm" > Techniques to achieve clean cross cutting concerns</header><ol id="markdown-toc"><li><a href="#scenario" id="markdown-toc-scenario">Scenario</a><ol><li><a href="#requirements" id="markdown-toc-requirements">Requirements</a></ol><li><a href="#techniques" id="markdown-toc-techniques">Techniques</a><ol><li><a href="#simple-approach" id="markdown-toc-simple-approach">Simple approach</a><li><a href="#dynamic-dispatch" id="markdown-toc-dynamic-dispatch">Dynamic dispatch</a><li><a href="#query-pattern" id="markdown-toc-query-pattern">Query pattern</a><li><a href="#aspect-oriented-programming-aop" id="markdown-toc-aspect-oriented-programming-aop">Aspect Oriented Programming (AOP)</a></ol><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><p>There are many techniques of varying sophistication to achieve clean cross cutting concerns. Let’s walk through some of them and discuss their pros and cons.<blockquote><p>This post mostly serves as a reference for myself, to gather my thoughts. I won’t bother with implementation details and sample code may not compile.</blockquote><h1 id="scenario">Scenario</h1><p>Imagine we have a repository that fetches weather data from a database.<p>It could look similar to the below, but assume many more methods.<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IWeatherRepository</span>
<span class="p">{</span>
    <span class="n">WeatherForecast</span> <span class="nf">GetForecast</span><span class="p">();</span>

    <span class="kt">int</span> <span class="nf">GetTemperature</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="requirements">Requirements</h2><p>We will evaluate the techniques based on the following requirements:<ol><li>We don’t really care about the implementation, but we want to start applying some caching to avoid repeated database calls, as we have a lot of read requests coming in and the data won’t change for some time.<ul><li>Bonus points for not needing to duplicate the caching code in each method.</ul><li>Initially we can use a memory cache, but later we might want to switch to a distributed cache.<ul><li>Bonus points for least amount of changes needed to switch the caching implementation.</ul><li>We want to apply other cross-cutting concerns to the repository, like logging.<ul><li>Bonus points for ease of extensibility and maintainability.</ul><li>Lastly, we want to be able to test the repository without caching and logging.</ol><h1 id="techniques">Techniques</h1><h2 id="simple-approach">Simple approach</h2><p>Often the first approach that comes to mind is to inject a cache and add the caching logic to each of the methods.<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">WeatherRepositoryWithCache</span> <span class="p">:</span> <span class="n">IWeatherRepository</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">IMemoryCache</span> <span class="n">cache</span><span class="p">;</span>

    <span class="k">public</span> <span class="n">WeatherForecast</span> <span class="nf">GetForecast</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="n">cache</span><span class="p">.</span><span class="nf">GetOrCreate</span><span class="p">(</span>
        <span class="k">nameof</span><span class="p">(</span><span class="n">GetForecast</span><span class="p">),</span>
        <span class="n">entry</span> <span class="p">=&gt;</span> <span class="n">Extensions</span><span class="p">.</span><span class="nf">GetDemoForecast</span><span class="p">());</span>

    <span class="k">public</span> <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">GetTemperature</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="n">cache</span><span class="p">.</span><span class="nf">GetOrCreate</span><span class="p">(</span>
        <span class="k">nameof</span><span class="p">(</span><span class="n">GetTemperature</span><span class="p">),</span>
        <span class="n">entry</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">().</span><span class="nf">Next</span><span class="p">(-</span><span class="m">10</span><span class="p">,</span> <span class="m">40</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div><p>It might seem simple at first, but once you start applying this at scale, you will quickly realize that this is not maintainable. Think about tens of repository classes, each with tens of methods.<h2 id="dynamic-dispatch">Dynamic dispatch</h2><p>By overriding the methods in our repository, we can achieve separation of concerns between the business logic and the caching.<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CachedWeatherRepository</span> <span class="p">:</span> <span class="n">WeatherRepository</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">MemoryCache</span> <span class="n">cache</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">override</span> <span class="n">WeatherForecast</span> <span class="nf">GetForecast</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">key</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateOnly</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">.</span><span class="n">GetOrCreate</span><span class="p">&lt;</span><span class="n">WeatherForecast</span><span class="p">&gt;(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">entry</span> <span class="p">=&gt;</span> <span class="k">base</span><span class="p">.</span><span class="nf">GetForecast</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Now we have a semi-central place for caching, although it still has to be duplicated per repository class. We also still have to duplicate the caching logic in each method.<p>Note that this requires the methods to be virtual. We can work around this limitation with the decorator pattern.<p>Given <code class="language-plaintext highlighter-rouge">n</code> repositories, and <code class="language-plaintext highlighter-rouge">m</code> cross-cutting concerns, we would need <code class="language-plaintext highlighter-rouge">n * m</code> subclasses. Simple code, but not maintainable.<h2 id="query-pattern">Query pattern</h2><p>This approach combines several patterns to achieve high flexibility.<p>The central idea is to treat any request to the database as a query object, which is passed to an executor. Contrary to their name, these query objects actually implement the command pattern, meaning they encapsulate a set of instructions that can be defined separately from their execution.<p>Usually, you will have some interface like this at the top level:<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">interface</span> <span class="nc">IQuery</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="n">T</span> <span class="nf">Execute</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div><p>Important is that these queries can be newed without any dependencies. We can then isolate the query specification / construction by using a factory. The concrete implementation depends on your database.<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">QueryFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">IQuery</span><span class="p">&lt;</span><span class="n">WeatherForecast</span><span class="p">&gt;</span> <span class="nf">BuildForecastQuery</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">QueryExpression</span><span class="p">(...);</span>
    
    <span class="k">public</span> <span class="n">IQuery</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">BuildTemperatureQuery</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">QueryExpression</span><span class="p">(...);</span>
<span class="p">}</span>
</code></pre></div></div><p>Using the decorator pattern, we can wrap the core query logic with additional behavior.<p>Combining this, you will end up with something like this:<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">QueryWeatherRepository</span> <span class="p">:</span> <span class="n">IWeatherRepository</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">QueryExecutor</span> <span class="n">queryExecutor</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">QueryFactory</span> <span class="n">queryFactory</span><span class="p">;</span>
    
    <span class="k">public</span> <span class="n">WeatherForecast</span> <span class="nf">GetForecast</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="n">queryFactory</span><span class="p">.</span><span class="nf">BuildForecastQuery</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">UseCaching</span><span class="p">()</span> <span class="c1">// extensions that leverage the decorator pattern</span>
            <span class="p">.</span><span class="nf">UseLogging</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">queryExecutor</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div><p>No subclassing, no virtual methods, no need to duplicate the caching or logging logic.<p>A downside is that you have to think and come up with a setup for this.<p>Let’s check off the requirements:<ul><li>No duplicated caching logic<li>Switching caching implementation only touches a single class (caching decorator)<li>We can add any cross-cutting concern by adding a decorator<li>We can test the queries independently</ul><p>One more thing to observe is how our code becomes much more declarative and high level. Our repository no longer dishes out specific, brittle instructions. Rather, we specify the behavior we would like to see and rely on the framework to execute it.<h2 id="aspect-oriented-programming-aop">Aspect Oriented Programming (AOP)</h2><p>Although I haven’t had a chance to try AOP in C# yet, I am familiar with <a href="https://en.wikipedia.org/wiki/AspectJ">AspectJ</a> and <a href="/blog/2020-02-20-spring-kotlin-gradle-aop/">Spring AOP</a>.<p><a href="https://www.postsharp.net/caching">PostSharp</a> is similar to Spring, with the main downside that it is commercial. We can add caching with a few attributes:<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">CacheConfiguration</span><span class="p">(</span><span class="n">AbsoluteExpiration</span> <span class="p">=</span> <span class="m">10</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">WeatherRepository</span> <span class="p">:</span> <span class="n">IWeatherRepository</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Cache</span><span class="p">]</span>
    <span class="k">public</span> <span class="n">WeatherForecast</span> <span class="nf">GetForecast</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div><p>This is easily the cleanest approach, requiring the least amount of code. You can add more behavior like logging or retry simply by adding the corresponding attributes.<p>It feels like magic, which is sometimes claimed to be a bad thing. I for one believe AOP is a true boon to software development. One downside is the framework buy-in.<p>Even if you don’t use AOP in your daily work, I still highly recommend learning about it on your own time. It gives you a new perspective that will help you identify and solve architectural problems in your code.<p>In particular, I found this course to be a great learning resource:<ul><li><a href="https://www.pluralsight.com/courses/aspect-oriented-programming-spring-aspectj">Aspect Oriented Programming (AOP) using Spring AOP and AspectJ by Eberhard Wolff</a></ul><h1 id="conclusion">Conclusion</h1><p>My personal favorite is the AOP approach, when available. Otherwise the query pattern is a good alternative that offers a lot of flexibility.<p>The simpler patterns can be used during POC, but any non-trivial app will benefit from a clear-defined architecture.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2023-02-12-dry-srp-caching/">🎨 DRY the paint on your Cross Cutting Concerns</a></footer></article><article id="post-blog-onsen-onsen" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/onsen/2022-10-30-onsen/" class="flip-title"> ♨️ My favorite hot springs 2022 </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2022-10-30T00:00:00-07:00">30 Oct 2022</time> in <span>Blog</span> / <a href="/onsen/" class="flip-title">Onsen</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 30 Apr 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-04-30T19:20:41-07:00">2025-04-30</time> </span></div><p class="note-sm" > Explore these fascinating hot springs around the globe.</header><ol id="markdown-toc"><li><a href="#yakushima" id="markdown-toc-yakushima">Yakushima</a><li><a href="#ischia" id="markdown-toc-ischia">Ischia</a><li><a href="#são-miguel" id="markdown-toc-são-miguel">São Miguel</a><ol><li><a href="#furnas" id="markdown-toc-furnas">Furnas</a></ol><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><p>The best (and most) hot springs are, no doubt, in onsen-country, Japan ♨️. However, there are still worthwhile alternatives in sometimes unexpected locations that I would recommend checking out. So instead of covering some of the famous onsen towns of Japan, let’s talk about some of the lesser-known options.<p>In particular, I am very fond of 海中温泉, meaning hot springs in the ocean. These hot springs developed naturally on the coast, which makes them quite unique.<h1 id="yakushima">Yakushima</h1><p>This small island south of the Japanese mainland is one of my favorite places in Japan, not least because of its amazing hot springs!<p>  <hy-img root-margin="512px"  src="/assets/img/yakushima.jpg" alt="Yakushima is beautiful" >    <noscript><img data-ignore  src="/assets/img/yakushima.jpg" alt="Yakushima is beautiful" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>The <a href="https://www.town.yakushima.kagoshima.jp/cust-facility/1421/">Hirauchi Kaichuu Onsen - 平内海中温泉</a> lies at the coast of the island and its basins are filled with ocean water. It’s basically free, but you are encouraged to donate a few hundred yen to the locals maintaining it.<p>  <hy-img root-margin="512px"  src="/assets/img/onsen_hirauchi.jpg" alt="The Hirauchi hot spring" >    <noscript><img data-ignore  src="/assets/img/onsen_hirauchi.jpg" alt="The Hirauchi hot spring" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>One of the coolest experiences is to come here in the night and enjoy the starry sky whilst taking a hot bath. There are various temperatures to choose from in the basins, but a little caution is required as some can get very hot.<p>We were here at the end of the year and the weather was amazing. Moderate temperature, sunny sky, tasty local produce like Ponkan, superb nature, and hot springs in the night made Yakushima one of my favorite destinations.<h1 id="ischia">Ischia</h1><p>Ischia is an island off the coast of Napoli in Italy.<p>  <hy-img root-margin="512px"  src="/assets/img/ischia.jpg" alt="Ischia is an island" >    <noscript><img data-ignore  src="/assets/img/ischia.jpg" alt="Ischia is an island" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>It’s a popular tourist destination and unfortunately we made the mistake of coming here during the summer, meaning it was very crowded and our overall experience wasn’t the best.<p>Besides some negative experiences, what saved the trip was our discovery of a hot spring in the ocean in the island’s southern part.<p>  <hy-img root-margin="512px"  src="/assets/img/onsen_baia_di_sorgeto.jpg" alt="Baia di Sorgeto Ischia" >    <noscript><img data-ignore  src="/assets/img/onsen_baia_di_sorgeto.jpg" alt="Baia di Sorgeto Ischia" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>Baia di Sorgeto is a little more difficult to access, but worth it every time. We spent every evening here. As it is entirely natural, this onsen is also free. There are a number of other (commercial) hot springs on the island, but they were all closed due to Covid. Even so, I felt the trip was worth it because Baia di Sorgeto was outstanding.<h1 id="são-miguel">São Miguel</h1><p>In the middle of the atlantic ocean lie the Azores, a group of Portugese islands, the biggest of which is São Miguel.<p>  <hy-img root-margin="512px"  src="/assets/img/sao_miguel.jpg" alt="São Miguel" >    <noscript><img data-ignore  src="/assets/img/sao_miguel.jpg" alt="São Miguel" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>I decided to visit because of the many similarities to Japan / Yakushima: A volcanic island with lush, green vegetation, warm but rainy weather, tea plantations, and of course hot springs ♨️.<p>It’s a bit difficult to get here, as there aren’t many international flights, so the most likely route is via Portugal’s mainland.<p>Anyway it’s worth the effort, as this island has so much to offer.<p>Caldeira Velha is like a little trip through the jungle, with hot springs along the way. Although there is only one smaller basin with really hot water, it’s a very atmospheric and relaxing journey.   <hy-img root-margin="512px"  src="/assets/img/onsen_caldeiravelha.jpg" alt="Caldeira Velha" >    <noscript><img data-ignore  src="/assets/img/onsen_caldeiravelha.jpg" alt="Caldeira Velha" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><hr /><p>Then there is Termas das Caldeiras, a smaller hot spring bath. We put this one off because it seemed too small from the reviews. In the end we did have an opportunity to try it, and it became one of our favorite experiences. The pools are small but we were lucky that there were few people and at some point we were even alone. Later on someone performed a few songs on a handpan. This was the best meditative atmosphere in any hot spring here. This place also has probably the hottest pool available.<hr /><p>There is also an onsen in the sea, but we had no luck with the tide, so the water wasn’t warm enough.   <hy-img root-margin="512px"  src="/assets/img/onsen_ponta_ferraria.jpg" alt="Ponta Ferraria" >    <noscript><img data-ignore  src="/assets/img/onsen_ponta_ferraria.jpg" alt="Ponta Ferraria" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> This hot spring goes by the name Ponta Ferraria, but it’s a little further away from everything so we didn’t try again.<h2 id="furnas">Furnas</h2><p>Then there is the little onsen town Furnas. I recommend staying here to maximize your time in the hot springs. Furnas is quite popular among locals and tourists, so expect a lot of traffic. Therefore, it’s better to be close by and flexible so that you can time your visits and spend extended time in the hot springs without having to worry about getting back home.<p>First up, the Poça da Dona Beija, which consists of several medium-size pools of depth. Definitely check it out, but be aware that it gets busy towards the evening.<hr /><p>The main attraction is Parque Terra Nostra, which is a botanical garden with several hot spring baths included. One of these is actually a gigantic pool in which you can swim freely.<p>  <hy-img root-margin="512px"  src="/assets/img/onsen_terra_nostra.jpg" alt="Terra Nostra" >    <noscript><img data-ignore  src="/assets/img/onsen_terra_nostra.jpg" alt="Terra Nostra" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>The park itself is well worth seeing, but that onsen pool is truly a rare sight to behold! It’s extremely satisfying to swim in the thermal water and you can find temperature differences throughout the pool.<hr /><p>Outside Japan, hot spring temperatures are usually lower and you rarely encounter foot-onsens, i.e. hot springs which you put your feet into. Furnas actually has one of those! It’s called Poça da Tia Silvina, and it’s exceptionally hot. This foot onsen it located on the river bank in Furnas and is free. Recommend to grab some desserts from the Glória Moniz bakery and come down here to relax. Might have to bring an umbrella :)<p>Lastly, they also make food with the thermal heat, which results in a dish called Cozido das Furnas. This is definitely worth trying! Amazing to see the many use cases thermal heat can fit into.<h1 id="conclusion">Conclusion</h1><p>Hot springs are amazing and I wish they could be found anywhere. In recent years I found a few hot springs that can make up for their general absence throughout Europe. I hope to visit many more in other parts of the world.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/onsen/2022-10-30-onsen/">♨️ My favorite hot springs 2022</a></footer></article><article id="post-blog-software-dataverse-perf-flow-loops" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2022-04-09-dataverse-perf-flow-loops/" class="flip-title"> ⚡ Power Automate - Iteration Performance </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2022-04-09T00:00:00-07:00">09 Apr 2022</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 30 Apr 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-04-30T19:23:38-07:00">2025-04-30</time> </span></div><p class="note-sm" > Addressing common performance bottlenecks in Flows. There is more to loops than meets the eye. Once again, functional beats imperative.</header><ol id="markdown-toc"><li><a href="#control" id="markdown-toc-control">Control</a><li><a href="#data-operations" id="markdown-toc-data-operations">Data Operations</a><ol><li><a href="#select" id="markdown-toc-select">Select</a><li><a href="#filter" id="markdown-toc-filter">Filter</a><li><a href="#change-of-approach" id="markdown-toc-change-of-approach">Change of approach</a></ol><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><p>Flows are a great tool for automation and integration, but whilst the low/no code paradigm aims to make programming more accessible, it also introduces some pitfalls that are not immediately obvious to both casual and professional programmers.<p>Performance is a frequently problematic area, as the restricted Flow development environment makes it hard to see why things are slow and doesn’t provide many options to address the issues.<h1 id="control">Control</h1><p>One issue I’ve seen come up again and again in Flows is the use of imperative iteration.   <hy-img root-margin="512px"  src="/assets/img/flow-control.png" alt="Flow control" >    <noscript><img data-ignore  src="/assets/img/flow-control.png" alt="Flow control" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>In other words, the two control actions <code class="language-plaintext highlighter-rouge">Apply to each</code> and <code class="language-plaintext highlighter-rouge">Do until</code>. At first glance, they seem like the go-to actions for looping.<p>Turns out you are better off avoiding them unless absolutely necessary, seeing as the performance is abyssmal. Consider this simple, bare-bones <code class="language-plaintext highlighter-rouge">Do until</code>, with a single action to increment an integer inside:   <hy-img root-margin="512px"  src="/assets/img/flow-loop-slow.png" alt="Flow loops are slow" >    <noscript><img data-ignore  src="/assets/img/flow-loop-slow.png" alt="Flow loops are slow" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>60 iterations took 12 seconds! This is completely unexpected for someone coming from traditional programming.<p>When using these control actions, what you’d likely expect to happen behind the scenes is something like the following:<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;</span> <span class="mi">60</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">i</span><span class="p">++</span>
<span class="p">}</span>
</code></pre></div></div><p>This should take mere nanoseconds, so how come it took 12 whole seconds in the Flow?<p>There is significant overhead associated with each iteration, leading to long durations and potential timeouts. Unlike a traditional while or for loop, the control actions spawn a sub process for each iteration.<p>Now imagine running this with 1000s of iterations. You can freeze your whole system if you’re not careful here.<p>As you can see, simple loops are very counter-intuitive in Flows. In order to rectify the situation, oftentimes the concurrency is upped. This does lead to faster execution, but increases the load on the system and can impact quota usage.   <hy-img root-margin="512px"  src="/assets/img/flow-concurrency.png" alt="Flow concurrency maxed out" >    <noscript><img data-ignore  src="/assets/img/flow-concurrency.png" alt="Flow concurrency maxed out" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> Besides, you’ll hit the max eventually.<p>Surely, there’s gotta be a better way, right? After all, loops are such a fundamental part of any program.<h1 id="data-operations">Data Operations</h1><p>The antidote to the <code class="language-plaintext highlighter-rouge">Control loop</code> slowness comes in the form of <code class="language-plaintext highlighter-rouge">Data operations</code>.<p>  <hy-img root-margin="512px"  src="/assets/img/flow-data-operations.png" alt="Flow data operations are fast" >    <noscript><img data-ignore  src="/assets/img/flow-data-operations.png" alt="Flow data operations are fast" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>Data operations are to control loops as declarative programming is to imperative. They are basically higher order functions.<p>Let’s see some quick examples as proof of their speed.<h2 id="select">Select</h2><p>One example could be the transformation of a set of row objects to an array of their ids.   <hy-img root-margin="512px"  src="/assets/img/flow-loop.png" alt="Flow loop" >    <noscript><img data-ignore  src="/assets/img/flow-loop.png" alt="Flow loop" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> The imperative <code class="language-plaintext highlighter-rouge">Apply to each</code> loop takes ~3 minutes for 300 records, even though the individual append operation takes less than a second. The functional <code class="language-plaintext highlighter-rouge">Select</code> operation completes within 1 second.<h2 id="filter">Filter</h2><p>Looping over 100 items, even without any logic in the condition, takes a significant amount of time.   <hy-img root-margin="512px"  src="/assets/img/flow-filter.png" alt="Flow filter" >    <noscript><img data-ignore  src="/assets/img/flow-filter.png" alt="Flow filter" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>The functional <code class="language-plaintext highlighter-rouge">Filter array</code> operation completes in less than a second, as we would expect from such a workload.<hr /><p>As we can see, data operations have the performance characteristics which we originally expected to see form the imperative approach.<p>There is hardly ever a reason not to use them, as long as the functional outcome is the same. One area that cannot be covered is the integration with external systems. Making a call to a system that expects a single data record cannot be optimized.<p>If you own the API, you can attempt a batch approach instead of one-by-one calls, and parse the data with data operations.<h2 id="change-of-approach">Change of approach</h2><p>As with the transition from imperative to functional, a different mindset is often required to effectively utilize data operations.<p>I encourage you to leave complex control structures and mutation behind, and instead focus on pure, higher-order functions processing collections rather than single records.<p>The best way to learn is to take up languages that naturally promote functional concepts. Although most mainstream languages support higher order functions by now, I personally learned a lot from diving into Kotlin, which I believe is the perfect bridge between imperative OO and functional.<h1 id="conclusion">Conclusion</h1><p>As a general guideline: Avoid looping over arrays of even medium size (100s). Prefer data operations like <code class="language-plaintext highlighter-rouge">Select</code>, <code class="language-plaintext highlighter-rouge">Compose</code>, <code class="language-plaintext highlighter-rouge">Join</code>, <code class="language-plaintext highlighter-rouge">Filter</code> to manipulate and transform multiple records at once. (Analogous to functional &gt; imperative in OO)<p>Reserve the control loops for situations where data operations cannot be used.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2022-04-09-dataverse-perf-flow-loops/">⚡ Power Automate - Iteration Performance</a></footer></article><article id="post-blog-topic-markers-in-language-design" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/2021-07-25-topic-markers-in-language-design/" class="flip-title"> Language features across the boundary </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2021-07-25T00:00:00-07:00">25 Jul 2021</time> in <span>Blog</span> </span> <span class="ellipsis" data-tippy-content="Last modified at: 07 Nov 2021"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2021-11-07T04:40:41-08:00">2021-11-07</time> </span></div><p class="note-sm" > Topic markers and context can help keep you DRY</header><ol id="markdown-toc"><li><a href="#topic-markers" id="markdown-toc-topic-markers">Topic markers</a><ol><li><a href="#implicit-topics" id="markdown-toc-implicit-topics">Implicit topics</a></ol><li><a href="#programming-analog" id="markdown-toc-programming-analog">Programming analog</a><ol><li><a href="#extension-functions-with-receivers" id="markdown-toc-extension-functions-with-receivers">Extension functions with receivers</a><ol><li><a href="#further-parallels" id="markdown-toc-further-parallels">Further parallels</a></ol></ol><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><p>In western languages we are used to repeatedly re-declare the topic we are talking about. There is hardly a sentence without a pronoun, and we often have to find <a href="https://owl.purdue.edu/owl/general_writing/academic_writing/sentence_variety/for_repeated_subjects_or_topics.html">creative ways</a> to reduce repetition, in order not to sound dry and robotic.<p>Imagine a typical conversation between person <code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code>:<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">A</span><span class="pi">:</span> <span class="s">How is your new teacher?</span>
<span class="na">B</span><span class="pi">:</span> <span class="s">I don't like him. He's too strict.</span>
<span class="na">A</span><span class="pi">:</span> <span class="s">Is he worse than Mr. X?</span>
<span class="na">B</span><span class="pi">:</span> <span class="s">No, but he still thinks it's the 80s.</span>
<span class="nn">...</span>
</code></pre></div></div><p>This could go on for quite a bit, but after the first sentence it should be clear to everyone what the topic is. Then why do we have to repeatedly refer to it?<p>Think about introducing yourself to an audience. Nobody is in doubt who you are talking about, yet practically every sentence will contain an <code class="language-plaintext highlighter-rouge">I</code> or <code class="language-plaintext highlighter-rouge">my</code>.<p>Growing up with such a language, this feels normal. Although, as developers, we tend to get an allergic reaction when seeing excessive repetition.<p>Once we discover an elegant alternative, we realize that languages like English, German, Danish are really quite verbose. They are said to be <a href="https://en.wikipedia.org/wiki/Topic-prominent_language">subject-prominent</a>.<h1 id="topic-markers">Topic markers</h1><p>Some natural languages, like Japanese and Korean, support a feature called <a href="https://en.wikipedia.org/wiki/Topic_marker">topic markers</a>. They allow you to declare a topic, and then largely omit referencing it throughout the conversation.<p>Going back to the previous example, once the topic is established, we can stop referring to it.<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">A</span><span class="pi">:</span> <span class="s">How is new teacher?</span>
<span class="na">B</span><span class="pi">:</span> <span class="s">Don't like. Too strict.</span>
<span class="na">A</span><span class="pi">:</span> <span class="s">Worse than Mr. X?</span>
<span class="na">B</span><span class="pi">:</span> <span class="s">No, but still thinks it's the 80s.</span>
<span class="nn">...</span>
</code></pre></div></div><p>This sounds unnatural in English, but is the default in Japanese. In fact, we can omit nearly all pronouns, as they are usually inferred from the context:<ul><li>When <code class="language-plaintext highlighter-rouge">A</code> asks <code class="language-plaintext highlighter-rouge">B</code> a question, <code class="language-plaintext highlighter-rouge">B</code> is not in doubt whose teacher <code class="language-plaintext highlighter-rouge">A</code> is talking about.<li>When <code class="language-plaintext highlighter-rouge">B</code> states her opinion, both know who about.<li>As long as the topic doesn’t change, there is no need to refer to the teacher with pronouns.</ul><h2 id="implicit-topics">Implicit topics</h2><p>Context-heavy languages assume a lot of implicit information, allowing for very succinct communication. Japanese is known for being on the extreme end of the context-heavy scala, as almost every sentence will omit some information.<blockquote><p>In high context cultures many of the words you might think of as essential in another linguistic setting become unnecessary or out of place. Japanese is one such language, where things are often implied by context and mutual understanding.<p><a href="https://www.italki.com/article/877/omitting-the-subject-in-japanese?hl=en">Source</a></blockquote><p><a href="https://en.wikipedia.org/wiki/Japanese_grammar#Thematic_wa">A classic</a> is the sentence <code class="language-plaintext highlighter-rouge">僕はウナギだ</code>, which can be interpreted as <code class="language-plaintext highlighter-rouge">I am an eel</code>, which doesn’t make much sense. The implicit context is that we are in a restaurant, where the sentence is used to state your order, as in <code class="language-plaintext highlighter-rouge">I'd like the eel, please</code>.<p>More generally, you omit pronouns in most conversations. When talking about yourself, stating your thoughts, or telling a story about your kids, you won’t have to say <code class="language-plaintext highlighter-rouge">I</code> / <code class="language-plaintext highlighter-rouge">my</code>. Once you open your mouth, it is clear that you are the topic. When seeing a colleague and asking a question, you won’t say <code class="language-plaintext highlighter-rouge">You</code>. The other person understands that he is the one being asked.<p>Once I went to a book store, where a band was playing. Just as I entered, they stopped playing, and I went up to one of the members to ask whether they would continue later. The entire conversation was:<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">Me</span><span class="pi">:</span> <span class="s">もう終わった？</span> <span class="c1"># ~ Already finished?</span>
<span class="na">He</span><span class="pi">:</span> <span class="s">まだ。</span>       <span class="c1"># ~ Still.</span>
</code></pre></div></div><p>I was taken aback by the curtness of his answer, but this is really quite common.<h1 id="programming-analog">Programming analog</h1><p>The first similar concept that comes to mind is a plain class, from which we can reference other members of the class without qualification.<p>As mentioned, in Japanese you can omit declaring yourself as the topic. Let’s imagine a class about ourselves, called <code class="language-plaintext highlighter-rouge">I</code>.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">I</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">think</span><span class="p">(</span><span class="n">about</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{}</span>
    
    <span class="k">fun</span> <span class="nf">say</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">think</span><span class="p">(</span><span class="s">"No more subject!"</span><span class="p">)</span>
        <span class="nf">think</span><span class="p">(</span><span class="s">"Context is awesome!"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>As opposed to:<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">i</span> <span class="p">=</span> <span class="nc">I</span><span class="p">()</span>

<span class="k">fun</span> <span class="nf">say</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">i</span><span class="p">.</span><span class="nf">think</span><span class="p">(</span><span class="s">"therefore I am"</span><span class="p">)</span>
    <span class="n">i</span><span class="p">.</span><span class="nf">think</span><span class="p">(</span><span class="s">"repetition is boring"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><p>Generally, good design will produce classes with low subject repetition. Similar to how we organize our prose to minimize repetition and keep the reader engaged. If we find ourselves frequently referring to the same subject, then that is a sign that the code belongs in a (topic) class.<p>This works well when we own the class, but what if the topic is out of our control?<h2 id="extension-functions-with-receivers">Extension functions with receivers</h2><p>Have you ever had to write a function which operates on an external type, like the below?<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">mutate</span><span class="p">(</span><span class="k">external</span><span class="p">:</span> <span class="nc">External</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">external</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">"Test"</span>
    <span class="k">external</span><span class="p">.</span><span class="n">age</span> <span class="p">=</span> <span class="mi">10_000</span>
    <span class="k">external</span><span class="p">.</span><span class="n">location</span> <span class="p">=</span> <span class="nf">getCurrentLocation</span><span class="p">()</span>
    <span class="k">external</span><span class="p">.</span><span class="n">status</span> <span class="p">=</span> <span class="o">..</span><span class="p">.</span>
    <span class="k">external</span><span class="p">.</span><span class="n">yetAnotherField</span> <span class="p">=</span> <span class="o">..</span><span class="p">.</span> 
    <span class="c1">/// 10 more fields to set</span>
<span class="p">}</span>
</code></pre></div></div><p>This is super annoying. We basically want a way to declare <code class="language-plaintext highlighter-rouge">external</code> as our topic, and then stop referring to it in every single line, as if it was a function of the class itself.<p>In Kotlin, <a href="https://kotlinlang.org/docs/extensions.html#extension-functions">extension functions</a> are declared by defining a receiver type for the function. Within its scope, the receiver becomes <code class="language-plaintext highlighter-rouge">this</code>, and can be omitted.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nc">External</span><span class="p">.</span><span class="nf">mutate</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">name</span> <span class="p">=</span> <span class="s">"Test"</span>
    <span class="n">age</span> <span class="p">=</span> <span class="mi">10_000</span>
    <span class="n">location</span> <span class="p">=</span> <span class="nf">getCurrentLocation</span><span class="p">()</span>
    <span class="n">status</span> <span class="p">=</span> <span class="o">..</span><span class="p">.</span>
    <span class="o">..</span><span class="p">.</span>
<span class="p">}</span>
</code></pre></div></div><p>Such receivers can be thought of as topic markers, indicating that the following block of code will invoke the topic without explicitly referencing it.<p>The standard library contains generic helper functions, like <code class="language-plaintext highlighter-rouge">apply</code> to facilitate this inline.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">StringBuilder</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
    <span class="nf">append</span><span class="p">(</span><span class="s">"Hello "</span><span class="p">)</span>
    <span class="n">names</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="nf">append</span><span class="p">(</span><span class="n">it</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="s">","</span><span class="p">)</span> <span class="p">}</span>
    <span class="nf">setLength</span><span class="p">(</span><span class="n">length</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nf">append</span><span class="p">(</span><span class="s">"!"</span><span class="p">)</span>
<span class="p">}.</span><span class="nf">toString</span><span class="p">()</span> <span class="c1">// Hello A, B!</span>
</code></pre></div></div><p>Without <code class="language-plaintext highlighter-rouge">apply</code>, we would have to declare the subject in every line, sometimes even twice. We could actually create a similar helper for the Japanese topic marker <code class="language-plaintext highlighter-rouge">は</code>:<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">infix</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="nc">T</span><span class="p">.</span><span class="err">は(</span><span class="nf">block</span><span class="p">:</span> <span class="nc">T</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">=</span> <span class="nf">block</span><span class="p">()</span>

<span class="nc">RestaurantOrder</span><span class="p">()</span> <span class="err">は</span> <span class="p">{</span> <span class="nf">unagi</span><span class="p">()</span> <span class="p">}</span>
</code></pre></div></div><p>Receivers are frequently leveraged to enable custom DSLs / <a href="https://kotlinlang.org/docs/type-safe-builders.html">type-safe builders</a>. For example, a type-safe way to build html in code:<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">html</span> <span class="p">{</span>
    <span class="nf">header</span> <span class="p">{</span>
        <span class="nf">stylesheet</span><span class="p">(</span><span class="n">color</span> <span class="p">=</span> <span class="s">"blue"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">body</span> <span class="p">{</span>
        <span class="nf">form</span> <span class="p">{</span>
            <span class="nf">textColumn</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">button</span><span class="p">(</span><span class="s">"OK"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">footer</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div><p>Another cool thing here is the notion of nested receivers / topics, just as in natural language. The <code class="language-plaintext highlighter-rouge">textColumn</code> only makes sense in the context of a form in a body in html.<p>Going back to the eel example, how could we express this in code? First, we can always assume an implicit context of <code class="language-plaintext highlighter-rouge">I</code>. Next, we are in a restaurant and, facing the waiter, it is clear that we intend to order food.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">I</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nc">RestaurantOrder</span><span class="p">.</span><span class="nf">unagi</span><span class="p">()</span> <span class="p">=</span> <span class="nf">order</span><span class="p">(</span><span class="nc">Menu</span><span class="p">.</span><span class="nc">EelOnRice</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="nc">I</span> <span class="p">{</span> <span class="c1">// implicit I</span>
    <span class="nf">restaurant</span> <span class="p">{</span> <span class="c1">// when in restaurant</span>
        <span class="nf">order</span> <span class="p">{</span> <span class="c1">// when about to order</span>
            <span class="nf">unagi</span><span class="p">()</span> <span class="c1">// when in the right context, a single word is sufficient</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Notice that we can define <a href="https://kotlinlang.org/docs/extensions.html#declaring-extensions-as-members">local extensions</a>! This really allows us to express the concept of sub-topics, i.e. the unagi restaurant order only applies to me.<h3 id="further-parallels">Further parallels</h3><p>In Japanese, adding back the omitted subject references still leads to grammatically correct sentences, but they will be perceived as awkward, and you will have trouble making yourself understood. This is analogous to unclean code with excessive duplication, or unnecessary qualifications. For others reading your code, this noise is an impairment to understanding your true intent.<h1 id="conclusion">Conclusion</h1><p>In programming, topics are generally handled by defining classes of cohesive members, which can operate on the topic without explicit references. Kotlin adds the magic by allowing the same behavior on external types via extensions. Bonus points for local extensions!<p>Natural languages like Japanese have a special topic marker particle which feels similar to defining the receiver on an extension function. In context-heavy languages we can omit a lot of implicit information, often leading to much shorter, concise sentences.<p>To me, both Kotlin and Japanese have a sense of elegance, as it is super easy to produce highly expressive and concise output.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/2021-07-25-topic-markers-in-language-design/">Language features across the boundary</a></footer></article><article id="post-blog-software-clean-arch-unit" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2021-04-24-clean-arch-unit/" class="flip-title"> Clean Architecture with ArchUnit </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2021-04-24T00:00:00-07:00">24 Apr 2021</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 30 Apr 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-04-30T19:23:38-07:00">2025-04-30</time> </span></div><p class="note-sm" > Enforcing a layered architecture with tests</header><ol id="markdown-toc"><li><a href="#setup" id="markdown-toc-setup">Setup</a><li><a href="#rules" id="markdown-toc-rules">Rules</a><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><p>In a <a href="/blog/2020-02-20-spring-kotlin-gradle-aop">previous post</a> I discussed ways in which AOP can help in defining our architecture, even allowing us to verify architectural rules at compile time.<p>While this approach certainly does work, it has a few drawbacks, like its reliance on AOP, which is not always an option. Furthermore, the way these rules are defined is slightly unnatural.<p>A more idiomatic way of automatically verifying one’s architecture is <a href="https://www.archunit.org/">ArchUnit</a>, which enables us to define our rules as unit tests.<p>Originally a Java library, the project has since been ported to C#, which makes sense, considering <s>Java</s> Kotlin and C# are the same language. If a truly useful library is created in either of these, it will eventually be ported to the others, just like for <a href="https://en.wikipedia.org/wiki/AspectJ">AspectJ</a> we now got <a href="https://www.postsharp.net/">PostSharp</a>.<p>Anyway, this is convenient for me, since I wanted to take a look at enforcing a clean architecture in C# today. (Please read <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">Uncle Bob’s post</a>) <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">  <hy-img root-margin="512px"  src="/assets/img/CleanArchitecture.jpg" alt="Overview of the Clean Architecture" >    <noscript><img data-ignore  src="/assets/img/CleanArchitecture.jpg" alt="Overview of the Clean Architecture" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img></a><p>In the Java ArchUnit, there is out of the box support for both <code class="language-plaintext highlighter-rouge">layered</code> and <code class="language-plaintext highlighter-rouge">onion</code> architectures, but not in the dotnet ports.<p>I won’t be going for a full-blown onion / clean arch as my purpose is to slowly evolve and improve the architecture of my project. Taking things from 0 to 100 in one step is likely not gonna benefit anyone, and it is easier to adapt to small, incremental changes. So, while the end goal is a clean architecture, for now I just want to implement some simple layer checks, similar to the ones shown in the image below.<p>  <hy-img root-margin="512px"  src="/assets/img/layer-check.png" alt="Overview of the Clean Architecture" >    <noscript><img data-ignore  src="/assets/img/layer-check.png" alt="Overview of the Clean Architecture" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><h2 id="setup">Setup</h2><p>I found two candidates for ArchUnit-style tests:<ul><li><a href="https://github.com/TNG/ArchUnitNET">ArchUnitNET</a><li><a href="https://github.com/BenMorris/NetArchTest">NetArchTest</a></ul><p>I decided to go with the former, as it is from TNG, the same team as the original library.<p>After installing, I noticed there is no assert support for <code class="language-plaintext highlighter-rouge">MSTest</code>, so I recommend to just copy the related classes from <a href="https://github.com/TNG/ArchUnitNET/tree/master/ArchUnitNET.xUnit">the xUnit folder</a>.<p><a href="https://github.com/AndreasVolkmann/archNet/tree/master/TestProject1/Arch">Here</a> is what I ended up with.<h2 id="rules">Rules</h2><p>The individual layers can be defined like this:<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">serviceLayer</span>     <span class="p">=</span> <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">ResideInNamespace</span><span class="p">(</span><span class="s">".Service"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">controllerLayer</span>  <span class="p">=</span> <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">ResideInNamespace</span><span class="p">(</span><span class="s">".Controller"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">peristenceLayer</span>  <span class="p">=</span> <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">ResideInNamespace</span><span class="p">(</span><span class="s">".Repository"</span><span class="p">);</span>
</code></pre></div></div><p>Let’s start with our first rule: None of our code should depend on any controller / inbound port.<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">LayeredArch_Controller</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">rule</span> <span class="p">=</span> <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">AreNot</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">controllerLayer</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">NotDependOnAny</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">controllerLayer</span><span class="p">);</span>

    <span class="n">rule</span><span class="p">.</span><span class="nf">Check</span><span class="p">(</span><span class="n">Architecture</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>The next rule prevents access from the persistence layer to the service layer.<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">Are</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">peristenceLayer</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">NotDependOnAny</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">serviceLayer</span><span class="p">);</span>
</code></pre></div></div><p>And lastly, only allow the service layer to access the persistence layer.<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">AreNot</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">serviceLayer</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">NotDependOnAny</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">peristenceLayer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>The complete test class is available <a href="https://github.com/AndreasVolkmann/archNet/blob/master/TestProject1/Arch/ArchitectureTests.cs">here</a>.<h2 id="conclusion">Conclusion</h2><p>ArchUnit provides an elegant way of defining architectural rules, helping you enforce your design. Whilst the AOP compile-time approach is great, too, I prefer an AOP-independent solution.<p>It would be great to have the layer and onion dsl ported to C#, too.<p>I will be experimenting with the layers and slowly approach a clean architecture.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2021-04-24-clean-arch-unit/">Clean Architecture with ArchUnit</a></footer></article><h2 class="sr-only">Pagination</h2><nav class="pagination heading clearfix" role="navigation"><ul><li class="pagination-item older" > <a class=" " href="/page-2/" rel="next" >Older</a><li class="pagination-item newer" > <span class=" ">Newer</span></ul></nav><footer class="content" role="contentinfo"><hr/><p><small class="copyright">© 2025. All rights reserved. </small><hr class="sr-only"/></footer></main></hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>(()=>{var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())})(); </script> <script src="/assets/js/hydejack-9.2.1.js" type="module"></script> <script src="/assets/js/LEGACY-hydejack-9.2.1.js" nomodule defer></script> <script>!function(w, d) { w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; /**/ ga('create', 'UA-134200014-1', 'auto'); /**/ var pushStateEl = d.getElementById('_pushState'); var timeoutId; pushStateEl.addEventListener('hy-push-state-load', function() { w.clearTimeout(timeoutId); timeoutId = w.setTimeout(function() { ga('set', 'page', w.location.pathname); ga('send', 'pageview'); }, 500); }); d.addEventListener('hy--cookies-ok', function () { w.ga(function(tracker) { w.ga("set", "anonymizeIp", undefined); localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId")); }); }); w.loadJSDeferred('https://www.google-analytics.com/analytics.js'); }(window, document);</script> <!--<![endif]--><div hidden><h2 class="sr-only">Templates (for web app):</h2><template id="_animation-template"><div class="animation-main fixed-top"><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="icon-link"></span> </a> </template> <template id="_dark-mode-template"> <button id="_dark-mode" class="nav-btn no-hover" > <span class="sr-only">Dark Mode</span> <span class="icon-brightness-contrast"></span> </button> </template></div></html>
