<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v9.2.1 <https://hydejack.com/>
--><head><title>Page 2 of 2 for Blog | Andreas Volkmann</title><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Blog" /><meta name="author" content="Andreas Volkmann" /><meta property="og:locale" content="en" /><meta name="description" content="The official Hydejack blog. Version updates, example content and how-to guides on how to blog with Jekyll." /><meta property="og:description" content="The official Hydejack blog. Version updates, example content and how-to guides on how to blog with Jekyll." /><link rel="canonical" href="https://andreasvolkmann.github.io//2/" /><meta property="og:url" content="https://andreasvolkmann.github.io//2/" /><meta property="og:site_name" content="Andreas Volkmann" /><meta property="og:type" content="website" /><link rel="prev" href="https://andreasvolkmann.github.io//" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Blog" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Andreas Volkmann"},"dateModified":"2024-09-13T22:07:20-07:00","description":"The official Hydejack blog. Version updates, example content and how-to guides on how to blog with Jekyll.","headline":"Blog","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://andreasvolkmann.github.io//assets/icons/icon.png"},"name":"Andreas Volkmann"},"url":"https://andreasvolkmann.github.io//2/"}</script><meta name="keywords" content="andreas,volkmann"><meta name="color-scheme" content="dark light"><meta name="theme-color" content="rgb(25,55,71)"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Andreas Volkmann"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="Andreas Volkmann"><meta name="generator" content="Hydejack v9.2.1" /><link rel="alternate" href="https://andreasvolkmann.github.io//2/" hreflang="en"><link type="application/atom+xml" rel="alternate" href="https://andreasvolkmann.github.io//feed.xml" title="Andreas Volkmann" /><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_katexPreload"> <noscript><link rel="stylesheet" href="/assets/bower_components/katex/dist/katex.min.css"></noscript> <script>((r,a)=>{function d(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=a.createElement("script"),e=(n.src=e,t&&d(n,"load",t,{once:!0}),a.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=a.createElement("script");function o(){r._loaded=!0,t&&d(n,"load",t,{once:!0});var e=a.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():d(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){d(a.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}})(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/'; w._publicPath = '/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = false; w._search = { DATA_URL: '/assets/sitedata.json?no-cache', STORAGE_KEY: 'mini-search/', INDEX_KEY: 'index--2025-07-06T15:17:31-07:00', }; w._clapButton = false; }(window);</script><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,.content .avatar,.nav-btn,.nav-btn-bar,.navbar,.message,.note-sm,#markdown-toc,.note,.hr-bottom,.hr-after::after,hr,.hr,p,body{transition:none}#_dark-mode{font-size:1.25rem}@media screen{body,body.light-mode{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0, 0, 0, 0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg)}body .content,body.light-mode .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}body.dark-mode{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body.dark-mode .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media screen and (prefers-color-scheme: light){body{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0, 0, 0, 0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg)}body .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}}@media screen and (prefers-color-scheme: dark){body{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.tippy-content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}}html{--font-family: system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, Arial, sans-serif;--font-family-heading: system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, Arial, sans-serif;--code-font-family: ui-monospace, Menlo, Monaco, Cascadia Mono, Segoe UI Mono, Roboto Mono, Oxygen Mono, Ubuntu Mono, Source Code Pro, Fira Mono, Droid Sans Mono, Consolas, Courier New, monospace;--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 900;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 104rem}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem;margin-bottom:1.5rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f6,h6,.h6,.f5,h5,.h5,.f4,.sidebar-nav-item,h4,.h4,.post-date,.f3,h3,.h3,.f2,h2,.h2,.f1,h1,.h1{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,.sidebar-nav-item,h4,.h4,.post-date{font-size:1.08rem;line-height:1.6}.f5,h5,.h5{font-size:1.04rem;line-height:1.7}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 104rem){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:4rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:4rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:3rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:2rem}@media screen and (min-width: 104rem){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:flex;justify-content:space-between;margin-top:-0.6rem;height:2rem;margin-bottom:.85rem;color:var(--gray)}.post-date>.ellipsis,#breadcrumbs.post-date>ul{cursor:pointer}.post-date [class^=icon-]{display:inline-block;font-size:smaller;margin-right:.25rem}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,#markdown-toc,.note{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,#markdown-toc,.note{background:rgba(0,0,0,0);color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.2rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,#markdown-toc:before,.note:before{font-size:.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,[title]#markdown-toc:before,[title].note:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:"";width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media(min-width: 64em){body::before{width:21rem}}@media(min-width: 104rem){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}#breadcrumbs>ul{height:1rem;margin:-1.5rem 0 .5rem;padding:0;font-size:.667rem;color:var(--menu-text);text-transform:uppercase;width:100%;list-style:none}#breadcrumbs>ul>li{display:inline}#breadcrumbs>ul>li a{color:var(--gray);text-decoration:none;border-bottom:none}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.ml1{margin-left:1rem}.mr1{margin-right:1rem}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.larger{font-size:larger}.smaller{font-size:smaller}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.ellipsis,#breadcrumbs>ul{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border{border:1px solid var(--border-color)}@media(min-width: 42em){.border-radius,.lead,.page .aspect-ratio.sixteen-nine.lead{border-radius:.5rem}}.fallback-img{background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports(text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}@supports(text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 104rem){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,.75);text-align:center;min-height:100vh}.sidebar.invert{color:rgba(32,32,32,.75)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,.2);text-decoration-color:rgba(255,255,255,.2)}.sidebar.invert a{color:#222;border-bottom-color:rgba(32,32,32,.2);text-decoration-color:rgba(32,32,32,.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center/cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32, 32, 32, 0) 0%, rgba(32, 32, 32, 0.5) 50%, rgba(32, 32, 32, 0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:"";display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar.invert .sidebar-about>a.sidebar-title::after{border-color:rgba(32,32,32,.2)}.sidebar.invert .sidebar-about>a.sidebar-title:hover::after{border-color:#222}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media(min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-bottom,.fixed-top{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:#fff;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 104rem){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:20.5rem;right:0;margin:auto;overflow:auto}}@media screen and (min-width: 104rem){body.no-break-layout:not(.no-toc) #markdown-toc{width:calc(50% - 31rem)}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;min-height:100vh}}@media screen and (min-width: 42em){.content{max-width:42rem}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{padding-top:9rem;margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 104rem){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 104rem){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"}</style><link rel="preload" as="style" href="/assets/css/hydejack-9.2.1.css" id="_stylePreload"><link rel="preload" as="style" href="/assets/icomoon/style.css" id="_iconsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/ </script> <noscript><link rel="stylesheet" href="/assets/css/hydejack-9.2.1.css"><link rel="stylesheet" href="/assets/icomoon/style.css"> </noscript><style id="_pageStyle"> html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79, 177, 186, 0.5);--accent-color-highlight: rgba(79, 177, 186, 0.1);--accent-color-darkened: #409ba3;--theme-color: rgb(25,55,71);--dark-mode-body-bg: hsl(200.8695652174, 5.9895833333%, 17.5%);--dark-mode-border-color: hsl(200.8695652174, 5.9895833333%, 22.5%)}</style><link rel="dns-prefetch" href="https://assets.gumroad.com"> <script type="module"> const loadJS = x => new Promise(r => window.loadJS(x).addEventListener('load', r)); let p1, p2, io1, io2, embedCreated, overlayCreated; document.querySelector('hy-push-state').addEventListener('load', () => { io1 ||= new IntersectionObserver(async (entries) => { if (entries.some(x => x.isIntersecting)) { p1 = p1 || loadJS('https://gumroad.com/js/gumroad-embed.js'); await p1; !embedCreated && await new Promise(function check1(res) { if (typeof createGumroadEmbed !== 'undefined') { embedCreated = 1; res(createGumroadEmbed()); } else setTimeout(() => check1(res), 200); }); await new Promise(function check2(res) { if (typeof GumroadEmbed !== 'undefined') res(GumroadEmbed.reload()); else setTimeout(() => check2(res), 200); }); } }, { rootMargin: '1440px' }); io2 ||= new IntersectionObserver(async (entries) => { if (entries.some(x => x.isIntersecting)) { p2 = p2 || loadJS('https://gumroad.com/js/gumroad.js'); await p2; !overlayCreated && await new Promise(function check(res) { if (typeof createGumroadOverlay !== 'undefined') { overlayCreated = 1; res(createGumroadOverlay()); } else setTimeout(() => check(res), 200); }); } }, { rootMargin: '300px' }); document.querySelectorAll('.gumroad-product-embed').forEach(el => io1.observe(el)); document.querySelectorAll('.gumroad-button').forEach(el => io2.observe(el)); }); </script><body class="no-break-layout"> <script> window._sunrise = 6; window._sunset = 18; ((e,s)=>{var d="light-mode",a="dark-mode",o=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(e=(o=o<=e._sunrise||o>=e._sunset?a:d)==a?d:a,s.body.classList.add(o),s.body.classList.remove(e))})(window,document); </script> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange > <hy-drawer id="_drawer" class="cover" side="left" threshold="10" noscroll opened ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(25,55,71);background-image:url(/assets/img/sidebar-bg.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/" tabindex="-1"> <img src="/assets/icons/icon.png" class="avatar" alt="Andreas Volkmann" width="120" height="120" loading="lazy" /> </a> <a class="sidebar-title" href="/"><h2 class="h1">Andreas Volkmann</h2></a><p class=""> Personal page.</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_drawer--opened" href="/posts/" class="sidebar-nav-item " > Blog </a><li> <a href="/onsen/" class="sidebar-nav-item " > Onsen </a><li> <a href="/software/" class="sidebar-nav-item " > Software </a><li> <a href="/about/" class="sidebar-nav-item " > About </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://github.com/AndreasVolkmann" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="https://play.spotify.com/user/113258637" title="Spotify" class="no-mark-external"> <span class="icon-spotify"></span> <span class="sr-only">Spotify</span> </a><li> <a href="https://soundcloud.com/shin-kudo" title="SoundCloud" class="no-mark-external"> <span class="icon-soundcloud"></span> <span class="sr-only">SoundCloud</span> </a><li> <a href="http://www.last.fm/user/shadowgonzo" title="Last.fm" class="no-mark-external"> <span class="icon-lastfm"></span> <span class="sr-only">Last.fm</span> </a><li> <a href="http://stackoverflow.com/users/5335131/andreas-volkmann" title="Stack Overflow" class="no-mark-external"> <span class="icon-stackoverflow"></span> <span class="sr-only">Stack Overflow</span> </a><li> <a href="https://www.linkedin.com/in/andreas-volkmann-a5553a106" title="LinkedIn" class="no-mark-external"> <span class="icon-linkedin2"></span> <span class="sr-only">LinkedIn</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-blog" role="main" ><nav id="breadcrumbs" class="screen-only"><ul><li><a href="/">home</a><li> <span>/</span> <span>2</span></ul></nav><article id="post-blog-software-clean-arch-unit" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2021-04-24-clean-arch-unit/" class="flip-title"> Clean Architecture with ArchUnit </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2021-04-24T00:00:00-07:00">24 Apr 2021</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 01 May 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-05-01T21:21:41-07:00">2025-05-01</time> </span></div><p class="note-sm" > Enforcing a layered architecture with tests</header><ul id="markdown-toc"><li><a href="#setup" id="markdown-toc-setup">Setup</a><li><a href="#rules" id="markdown-toc-rules">Rules</a><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ul><p>In a <a href="/blog/2020-02-20-spring-kotlin-gradle-aop">previous post</a> I discussed ways in which AOP can help in defining our architecture, even allowing us to verify architectural rules at compile time.<p>While this approach certainly does work, it has a few drawbacks, like its reliance on AOP, which is not always an option. Furthermore, the way these rules are defined is slightly unnatural.<p>A more idiomatic way of automatically verifying one’s architecture is <a href="https://www.archunit.org/">ArchUnit</a>, which enables us to define our rules as unit tests.<p>Originally a Java library, the project has since been ported to C#, which makes sense, considering <s>Java</s> Kotlin and C# are the same language. If a truly useful library is created in either of these, it will eventually be ported to the others, just like for <a href="https://en.wikipedia.org/wiki/AspectJ">AspectJ</a> we now got <a href="https://www.postsharp.net/">PostSharp</a>.<p>Anyway, this is convenient for me, since I wanted to take a look at enforcing a clean architecture in C# today. (Please read <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">Uncle Bob’s post</a>) <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html"><img src="/assets/img/CleanArchitecture.jpg" alt="Overview of the Clean Architecture" /></a><p>In the Java ArchUnit, there is out of the box support for both <code class="language-plaintext highlighter-rouge">layered</code> and <code class="language-plaintext highlighter-rouge">onion</code> architectures, but not in the dotnet ports.<p>I won’t be going for a full-blown onion / clean arch as my purpose is to slowly evolve and improve the architecture of my project. Taking things from 0 to 100 in one step is likely not gonna benefit anyone, and it is easier to adapt to small, incremental changes. So, while the end goal is a clean architecture, for now I just want to implement some simple layer checks, similar to the ones shown in the image below.<p><img src="/assets/img/layer-check.png" alt="Overview of the Clean Architecture" /><h2 id="setup">Setup</h2><p>I found two candidates for ArchUnit-style tests:<ul><li><a href="https://github.com/TNG/ArchUnitNET">ArchUnitNET</a><li><a href="https://github.com/BenMorris/NetArchTest">NetArchTest</a></ul><p>I decided to go with the former, as it is from TNG, the same team as the original library.<p>After installing, I noticed there is no assert support for <code class="language-plaintext highlighter-rouge">MSTest</code>, so I recommend to just copy the related classes from <a href="https://github.com/TNG/ArchUnitNET/tree/master/ArchUnitNET.xUnit">the xUnit folder</a>.<p><a href="https://github.com/AndreasVolkmann/archNet/tree/master/TestProject1/Arch">Here</a> is what I ended up with.<h2 id="rules">Rules</h2><p>The individual layers can be defined like this:<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">serviceLayer</span>     <span class="p">=</span> <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">ResideInNamespace</span><span class="p">(</span><span class="s">".Service"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">controllerLayer</span>  <span class="p">=</span> <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">ResideInNamespace</span><span class="p">(</span><span class="s">".Controller"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">peristenceLayer</span>  <span class="p">=</span> <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">ResideInNamespace</span><span class="p">(</span><span class="s">".Repository"</span><span class="p">);</span>
</code></pre></div></div><p>Let’s start with our first rule: None of our code should depend on any controller / inbound port.<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">LayeredArch_Controller</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">rule</span> <span class="p">=</span> <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">AreNot</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">controllerLayer</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">NotDependOnAny</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">controllerLayer</span><span class="p">);</span>

    <span class="n">rule</span><span class="p">.</span><span class="nf">Check</span><span class="p">(</span><span class="n">Architecture</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>The next rule prevents access from the persistence layer to the service layer.<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">Are</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">peristenceLayer</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">NotDependOnAny</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">serviceLayer</span><span class="p">);</span>
</code></pre></div></div><p>And lastly, only allow the service layer to access the persistence layer.<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">AreNot</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">serviceLayer</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">NotDependOnAny</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">peristenceLayer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>The complete test class is available <a href="https://github.com/AndreasVolkmann/archNet/blob/master/TestProject1/Arch/ArchitectureTests.cs">here</a>.<h2 id="conclusion">Conclusion</h2><p>ArchUnit provides an elegant way of defining architectural rules, helping you enforce your design. Whilst the AOP compile-time approach is great, too, I prefer an AOP-independent solution.<p>It would be great to have the layer and onion dsl ported to C#, too.<p>I will be experimenting with the layers and slowly approach a clean architecture.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2021-04-24-clean-arch-unit/">Clean Architecture with ArchUnit</a></footer></article><article id="post-blog-software-arkenv-new-release" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2021-04-03-arkenv-new-release/" class="flip-title"> Arkenv v3.2.0 - available on maven central </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2021-04-03T00:00:00-07:00">03 Apr 2021</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 01 May 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-05-01T21:21:41-07:00">2025-05-01</time> </span></div><p class="note-sm" > New repository, new features, and a look at how we got here</header><ul id="markdown-toc"><li><a href="#background" id="markdown-toc-background">Background</a><li><a href="#new-repository" id="markdown-toc-new-repository">New repository</a><li><a href="#new-features" id="markdown-toc-new-features">New features</a><ul><li><a href="#plain-class-support" id="markdown-toc-plain-class-support">Plain class support</a><ul><li><a href="#constructor-injection" id="markdown-toc-constructor-injection">Constructor injection</a><li><a href="#modules" id="markdown-toc-modules">Modules</a></ul><li><a href="#new-feature-syntax" id="markdown-toc-new-feature-syntax">New feature syntax</a></ul><li><a href="#breaking-changes" id="markdown-toc-breaking-changes">Breaking changes</a><li><a href="#further-information" id="markdown-toc-further-information">Further information</a></ul><p>I am happy to announce that we have migrated from JCenter to <a href="https://search.maven.org/search?q=arkenv">Maven Central</a>, and are releasing version <code class="language-plaintext highlighter-rouge">3.2.0</code> with new features, including plain class support and constructor injection. Before we dive into the news, I want to take a look back at how we got here.<p><img src="https://raw.githubusercontent.com/aPureBase/arkenv/master/docs/arkenv_logo.png" alt="Arkenv logo" /><p>Throughout its lifetime, <a href="https://github.com/aPureBase/arkenv">Arkenv</a> has offered many great learning opportunities, and having the chance to create such a project is something I wish upon every developer.<p>Even though it is in no way a complex, or groundbreaking venture, I still consider it an important stepping stone, being my first open-source library. Keeping the scope small and manageable is probably an advantage when starting out.<h2 id="background">Background</h2><p>There were two primary reasons for the conception of Arkenv.<p>Firstly, we were looking for a way to seamlessly bridge the changing configuration needs in different environments with minimal developer intervention. Starting out with command line libraries like <a href="https://github.com/cbeust/jcommander">JCommander</a>, we soon realized that we wanted a central abstraction to define our external configuration, which didn’t depend on the configuration source. Pretty much like <a href="https://spring.io/blog/2020/04/23/spring-tips-configuration">Environment</a> in Spring.<p>For example, we wanted to be able to go from a command line-driven environment to an environment variable-driven one without having to add code or recompile.<p>Secondly, I really wanted to try to build something with <a href="https://kotlinlang.org/docs/delegated-properties.html">Kotlin delegates</a>. Another issue we had with many existing, annotation-based libraries, was the lack of type-safety and null support. Quickly, we saw that delegates were a perfect fit for these criteria, and the first version with CLI and ENV support didn’t fill more than a few lines.<p>The idea was to declare an immutable property, with nullability indicating whether it is optional or not, and whose name is used to resolve it.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">port</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">by</span> <span class="nf">argument</span><span class="p">()</span>
</code></pre></div></div><p>Once declared, it can be provided via CLI <code class="language-plaintext highlighter-rouge">--port 443</code>, environment variable <code class="language-plaintext highlighter-rouge">PORT=443</code>, or in a profile (properties, yaml) <code class="language-plaintext highlighter-rouge">port: 443</code>.<p>Later on we added support for other sources, like <a href="https://apurebase.gitlab.io/arkenv/features/dot-env-files/">.env files</a> and <a href="https://apurebase.gitlab.io/arkenv/features/docker-secrets/">Docker secrets</a>.<h2 id="new-repository">New repository</h2><p>With the announcement of JCenter ending support of their popular repository, many open-source projects had to migrate to Maven Central. We could have lived without this interruption, but on the other hand, it is great to be able to go with the default repository.<p>From now on, all new releases will be available here.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">repositories</span> <span class="p">{</span>
    <span class="nf">mavenCentral</span><span class="p">()</span>
<span class="p">}</span>

<span class="nf">implementation</span><span class="p">(</span><span class="s">"com.apurebase"</span><span class="p">,</span> <span class="s">"arkenv"</span><span class="p">,</span> <span class="s">"3.2.0"</span><span class="p">)</span>
<span class="nf">implementation</span><span class="p">(</span><span class="s">"com.apurebase"</span><span class="p">,</span> <span class="s">"arkenv-yaml"</span><span class="p">,</span> <span class="s">"3.2.0"</span><span class="p">)</span> <span class="c1">// for yaml support</span>
</code></pre></div></div><h2 id="new-features">New features</h2><h3 id="plain-class-support">Plain class support</h3><p>It is no longer necessary to extend <code class="language-plaintext highlighter-rouge">Arkenv</code> when defining an argument class.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">object</span> <span class="nc">Configuration</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">port</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">by</span> <span class="nf">argument</span><span class="p">()</span>
<span class="p">}</span>

<span class="nc">Arkenv</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nc">Arguments</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</code></pre></div></div><p>Plain classes do not have a <code class="language-plaintext highlighter-rouge">help</code> argument by default.<h4 id="constructor-injection">Constructor injection</h4><p>Instead of declaring arguments, one can now let <code class="language-plaintext highlighter-rouge">Arkenv</code> inject directly into the constructor of a plain class.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="kd">val</span> <span class="py">port</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>

<span class="c1">// construct an instance with the parse factory function</span>
<span class="kd">val</span> <span class="py">configuration</span> <span class="p">=</span> <span class="nc">Arkenv</span><span class="p">.</span><span class="n">parse</span><span class="p">&lt;</span><span class="nc">Configuration</span><span class="p">&gt;(</span><span class="n">args</span><span class="p">)</span>
</code></pre></div></div><p>Consequently, we cannot apply any config to these arguments, but default values are supported natively.<h4 id="modules">Modules</h4><p>The above approaches can be combined freely, and both support modules, too. In plain classes, modules are declared with a delegate, i.e. <code class="language-plaintext highlighter-rouge">by module()</code>. The module delegate function also accepts a configuration lambda with prefix support.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">SubConfig</span><span class="p">(</span><span class="kd">val</span> <span class="py">country</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">port</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">by</span> <span class="nf">argument</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">object</span>  <span class="nc">Configuration</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">subModule</span> <span class="k">by</span> <span class="n">module</span><span class="p">&lt;</span><span class="nc">SubConfig</span><span class="p">&gt;()</span>
<span class="p">}</span>

<span class="nc">Arkenv</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nc">Configuration</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
<span class="nc">Configuration</span><span class="p">.</span><span class="n">subModule</span><span class="p">.</span><span class="n">port</span> <span class="c1">// member access</span>
</code></pre></div></div><p>The above <code class="language-plaintext highlighter-rouge">SubConfig</code> class accepts constructor parameters and declares arguments in its body.<p>The <code class="language-plaintext highlighter-rouge">Configuration</code> object declares a module that is automatically created on parse.<h3 id="new-feature-syntax">New feature syntax</h3><p>Features can now be configured with <code class="language-plaintext highlighter-rouge">+</code> and <code class="language-plaintext highlighter-rouge">-</code>.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">configuration</span> <span class="p">=</span> <span class="nc">Arkenv</span><span class="p">.</span><span class="n">parse</span><span class="p">&lt;</span><span class="nc">Configuration</span><span class="p">&gt;(</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">+</span><span class="nc">ProfileFeature</span><span class="p">(</span><span class="n">prefix</span> <span class="p">=</span> <span class="s">"app"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="breaking-changes">Breaking changes</h2><p>Most extension functions have moved to the <code class="language-plaintext highlighter-rouge">util</code> package. This will break your build when upgrading, but should be easy to fix, by importing the correct packages.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//import com.apurebase.arkenv.parse</span>
<span class="k">import</span> <span class="nn">com.apurebase.arkenv.util.parse</span>
</code></pre></div></div><h2 id="further-information">Further information</h2><p>Log any bugs or feature requests on <a href="https://github.com/aPureBase/arkenv">Github</a>.<p>📃 Please visit <a href="https://apurebase.gitlab.io/arkenv/">https://apurebase.gitlab.io/arkenv/</a> for in-depth documentation.<p>🤝 Ask any questions in the Arkenv channel in the <a href="https://kotlinlang.slack.com/messages/CGF74HD19/">official Kotlin Slack</a>.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2021-04-03-arkenv-new-release/">Arkenv v3.2.0 - available on maven central</a></footer></article><article id="post-blog-software-xpp-chain-of-command" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2021-01-25-xpp-chain-of-command/" class="flip-title"> The x++ Chain of Command </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2021-01-25T00:00:00-08:00">25 Jan 2021</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 01 May 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-05-01T21:21:41-07:00">2025-05-01</time> </span></div><p class="note-sm" > Multi-tenant class extension without stepping on each other’s toes.</header><ul id="markdown-toc"><li><a href="#extending-code" id="markdown-toc-extending-code">Extending code</a><li><a href="#next" id="markdown-toc-next">Next</a><li><a href="#parallels" id="markdown-toc-parallels">Parallels</a></ul><p>One of my favorite features of the x++ programming language is the ability to extend classes by creating a chain of command, also referred to as <code class="language-plaintext highlighter-rouge">CoC</code>.<p>It allows multiple consumers to seamlessly augment existing code side-by-side with minimal work required from the owner.<p>This is especially valuable for software where customization is the norm and multiple independent parties want to customize the same code.<p>The result is a flexible extension model conforming to the open/closed principle.<h2 id="extending-code">Extending code</h2><p>Given a class <code class="language-plaintext highlighter-rouge">OrderSubmitService</code> as defined below, we want to customize the validation behavior when an order is submitted.<p>Inheritance is not an option, as the class is final. Furthermore, this approach requires that the class can be substituted at its call site, which is often not possible.<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// file: "OrderSubmitService.xpp"</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">OrderSubmitService</span> <span class="c1">// final class, no inheritance</span>
<span class="o">{</span>
    <span class="kd">protected</span> <span class="nc">SimpleOrder</span> <span class="n">simpleOrder</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">submitOrder</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">validateOrder</span><span class="o">())</span>
        <span class="o">{</span>
            <span class="n">simpleOrder</span><span class="o">.</span><span class="na">submit</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">validateOrder</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="n">simpleOrder</span><span class="o">.</span><span class="na">Amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">// we want to customize this</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Ideally, we would like to just add our custom logic to the <code class="language-plaintext highlighter-rouge">validateOrder</code> method.<h2 id="next">Next</h2><p>In order to create a chain of command, we create a new class with the <code class="language-plaintext highlighter-rouge">_Extension</code> suffix and add a reference to the target class in the <code class="language-plaintext highlighter-rouge">ExtensionOf</code> attribute.<p>Then we are free to declare any public or protected methods from the target class and define custom behavior.<p>In the below example we add another validation step to the existing one.<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// file: "OrderSubmitService_Extension.xpp"</span>
<span class="o">[</span><span class="nc">ExtensionOf</span><span class="o">(</span><span class="n">classStr</span><span class="o">(</span><span class="nc">OrderSubmitService</span><span class="o">))]</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">OrderSubmitService_Extension</span>
<span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">validateOrder</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">isAvailable</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">simpleOrder</span><span class="o">.</span><span class="na">IsAvailable</span><span class="o">;</span> <span class="c1">// access to protected members</span>
        <span class="k">return</span> <span class="n">next</span> <span class="nf">validateOrder</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">isAvailable</span><span class="o">;</span> <span class="c1">// calling next is mandatory</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Calling next invokes the next extension in the chain, until it reaches the base implementation.<p>In this way, independent parties can add more layers of code on top of the core, which can be locked down to prevent unintended side effects.<p>Looking at the code, this seems oddly familiar.<h2 id="parallels">Parallels</h2><p>There are no other languages with CoC support, AFAIK, but one parallel came to mind.<p>We can achieve similar results with <code class="language-plaintext highlighter-rouge">@Around</code> advice in AOP as shown in the Kotlin Spring code below.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// file: "OrderSubmitServiceExtension.kt"</span>
<span class="nd">@Aspect</span>
<span class="nd">@Component</span>
<span class="kd">class</span> <span class="nc">OrderSubmitServiceExtension</span> <span class="p">{</span>

  <span class="nd">@Around</span><span class="p">(</span><span class="s">"execution(* OrderSubmitService.validateOrder(..)) &amp;&amp; target(orderSubmitService)"</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">validateOrder</span><span class="p">(</span><span class="n">next</span><span class="p">:</span> <span class="nc">ProceedingJoinPoint</span><span class="p">,</span> <span class="n">orderSubmitService</span><span class="p">:</span> <span class="nc">OrderSubmitService</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">isAvailable</span> <span class="p">=</span> <span class="n">orderSubmitService</span><span class="p">.</span><span class="n">simpleOrder</span><span class="p">.</span><span class="nc">IsAvailable</span>
    <span class="k">return</span> <span class="n">next</span><span class="p">.</span><span class="nf">proceed</span><span class="p">()</span> <span class="p">&amp;&amp;</span> <span class="n">isAvailable</span> <span class="k">as</span> <span class="nc">Boolean</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>There are some major differences and changes needed to make this work, like not being able to access protected members, but otherwise it is really cool to observe the similarities here.<p>Calling <code class="language-plaintext highlighter-rouge">next</code> in x++ is required, but we can ignore the result in both. Both provide access to the target class.<p>Whereas AOP is commonly leveraged to address cross-cutting concerns, CoC addresses the cross-cutting concern of code extensibility in x++.<p>The extension model of x++ is of course much more than CoC. For example, you can also add state to classes via extensions. But I have to say, I really came to appreciate the power of the Chain of Command in creating elegant, extensible solutions with minimal boilerplate.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2021-01-25-xpp-chain-of-command/">The x++ Chain of Command</a></footer></article><article id="post-blog-software-spring-aop-feature-switches" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2020-11-25-spring-aop-feature-switches/" class="flip-title"> Spring AOP - Feature Switches </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2020-11-25T00:00:00-08:00">25 Nov 2020</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 01 May 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-05-01T21:21:41-07:00">2025-05-01</time> </span></div><p class="note-sm" > Handle feature switch checks with AOP.</header><ul id="markdown-toc"><li><a href="#the-aspect" id="markdown-toc-the-aspect">The Aspect</a></ul><p>One idea I recently happened upon is handling feature switches in an aspect. Essentially, we want to externally control whether certain code should execute or not.<p>This is really a cross-cutting concern, and thereby a top contender for AOP! One way to identify candidates for AOP is looking for those small bits of code that are scattered around your code base which do not really contribute to the single responsibility of the class.<p>For feature switches it is annoying having to always inject some feature manager and start things off with:<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">isEnabled</span> <span class="p">=</span> <span class="n">featureSwitchManager</span><span class="p">.</span><span class="nf">isEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="n">isEnabled</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// actual code</span>
<span class="p">}</span>
</code></pre></div></div><p>This is a kind of meta capability that our code shouldn’t have to worry about. Additionally, we are usually happier testing the code without all this extra noise.<h2 id="the-aspect">The Aspect</h2><p>The source is available <a href="https://github.com/AndreasVolkmann/playground/blob/master/src/main/kotlin/me/avo/cosmos/aspect/FeatureAspect.kt">here</a>.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Aspect</span>
<span class="nd">@Component</span>
<span class="kd">class</span> <span class="nc">FeatureAspect</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">featureSwitchManager</span><span class="p">:</span> <span class="nc">FeatureSwitchManager</span>
<span class="p">)</span> <span class="p">{</span>

    <span class="nd">@Pointcut</span><span class="p">(</span><span class="n">value</span> <span class="p">=</span> <span class="s">"execution(public * *(..))"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">anyPublicMethod</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Unit</span>

    <span class="nd">@Around</span><span class="p">(</span><span class="s">"anyPublicMethod() &amp;&amp; @annotation(annotation)"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">proceedIfEnabled</span><span class="p">(</span><span class="n">joinPoint</span><span class="p">:</span> <span class="nc">ProceedingJoinPoint</span><span class="p">,</span> <span class="k">annotation</span><span class="p">:</span> <span class="nc">FeatureSwitch</span><span class="p">):</span> <span class="nc">Any</span><span class="p">?</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">featureName</span> <span class="p">=</span> <span class="k">annotation</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="nf">takeIf</span><span class="p">(</span><span class="nc">String</span><span class="o">::</span><span class="n">isNotBlank</span><span class="p">)</span>
            <span class="o">?:</span> <span class="k">throw</span> <span class="nc">FeatureNameBlankException</span><span class="p">(</span><span class="n">joinPoint</span><span class="p">.</span><span class="n">signature</span><span class="p">)</span>

        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">featureSwitchManager</span><span class="p">.</span><span class="nf">isEnabled</span><span class="p">(</span><span class="n">featureName</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">true</span> <span class="p">-&gt;</span> <span class="n">joinPoint</span><span class="p">.</span><span class="nf">proceed</span><span class="p">()</span>
            <span class="k">false</span> <span class="p">-&gt;</span> <span class="k">null</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>The implementation is super simple. We define a pointcut for any public methods with the <code class="language-plaintext highlighter-rouge">@FeatureSwitch</code> annotation, and pass the provided feature name to the <code class="language-plaintext highlighter-rouge">FeatureSwitchManager</code>, implementing the actual feature check.<p>An example of a consuming service:<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">class</span> <span class="nc">MessageService</span> <span class="p">{</span>

    <span class="nd">@FeatureSwitch</span><span class="p">(</span><span class="s">"MessageService"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s">"Running message service!"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Now the run method can be enabled by passing <code class="language-plaintext highlighter-rouge">true</code> in the application properties:<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">MessageService</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div><p>And there you have it. A simple AOP solution, taking care of feature switch boilerplate code.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2020-11-25-spring-aop-feature-switches/">Spring AOP - Feature Switches</a></footer></article><article id="post-blog-software-spring-aop-logging" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2020-09-27-spring-aop-logging/" class="flip-title"> Spring AOP - CustomizableTraceInterceptor </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2020-09-27T00:00:00-07:00">27 Sep 2020</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 01 May 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-05-01T21:21:41-07:00">2025-05-01</time> </span></div><p class="note-sm" > Immediate, automated insights into your application.</header><ul id="markdown-toc"><li><a href="#logger-configuration" id="markdown-toc-logger-configuration">Logger configuration</a><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ul><p>The more I learn about Spring, the more I come to understand and appreciate its true power, with one major appeal being developer productivity.<p>In my <a href="https://andreasvolkmann.github.io/blog/2020-02-20-spring-kotlin-gradle-aop/">previous post</a> I discussed some useful things we can do with aspect oriented programming, including logging. Spring covers many of these use cases out of the box, without any additional concepts or dependencies. Let’s explore how to configure a trace interceptor and how this can make us more productive.<p>Oftentimes, when we encounter a bug in the live application, we want to get a deeper understanding of what lead to the current state and turn to the logs. Now, during development we may not have decided upon and set up detailed logging, which leads us to add some additional logging or print statements to get insights into the erroneous process.<p>This costs time, is annoying, and is ultimately not a very lean process, as a better alternative is available. The premise is the following:<blockquote><p>Automatically provide meaningful insights into the app. Configure once, applied seamlessly to any existing or new code without additional work.</blockquote><p>Say you implement a new part of your app, including a service with one central method:<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">class</span> <span class="nc">TestService</span> <span class="p">{</span>

    <span class="k">fun</span> <span class="nf">testMultiply</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
        <span class="nc">Thread</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"TEST!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span> <span class="p">*</span> <span class="n">y</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Now, during testing it turns out there is a bug which leads to inconsistent results, even though you are sure the input params are as expected.<p>Wouldn’t it be nice to have the following in your logs:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">2020-09-27 13:32:51.404 TRACE 2220 --- [Test worker] m.a.y.s.TestService</span><span class="err">:</span> <span class="s">Entering testMultiply(6,7)</span>
<span class="s">TEST!</span>
<span class="s">2020-09-27 13:32:51.654 TRACE 2220 --- [Test worker] m.a.y.s.TestService</span><span class="err">:</span> <span class="s">Leaving testMultiply(), returned 42, running time = 250 ms</span>
</code></pre></div></div><p>This includes a message on entering and leaving the method, with information about the parameters, the return value and the time spent. This can be customized further, but is usually a good starting point.<h3 id="logger-configuration">Logger configuration</h3><p>Here is the corresponding logger configuration. Source available <a href="https://github.com/AndreasVolkmann/Yunyin/blob/master/src/main/kotlin/me/avo/yunyin/config/LoggerConfig.kt">here</a>.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">class</span> <span class="nc">LoggerConfig</span> <span class="p">{</span>

    <span class="nd">@Bean</span> <span class="k">fun</span> <span class="nf">customizableTraceInterceptor</span><span class="p">()</span> <span class="p">=</span> <span class="nc">CustomizableTraceInterceptor</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
        <span class="nf">setUseDynamicLogger</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
        <span class="nf">setEnterMessage</span><span class="p">(</span><span class="s">"Entering $[methodName]($[arguments])"</span><span class="p">)</span>
        <span class="nf">setExitMessage</span><span class="p">(</span><span class="s">"Leaving $[methodName](), returned $[returnValue], running time = $[invocationTime] ms"</span><span class="p">)</span>
        <span class="nf">setExceptionMessage</span><span class="p">(</span><span class="s">"Error $[methodName](), exception $[exception], running time = $[invocationTime] ms"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nd">@Bean</span> <span class="k">fun</span> <span class="nf">loggingAdvisor</span><span class="p">():</span> <span class="nc">Advisor</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">pointcut</span> <span class="p">=</span> <span class="nc">AspectJExpressionPointcut</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
            <span class="n">expression</span> <span class="p">=</span> <span class="s">"""
                execution (* (@org.springframework.stereotype.Service *).*(..)) 
             || execution (* (@org.springframework.stereotype.Component *).*(..))
            """</span><span class="p">.</span><span class="nf">trimIndent</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nc">DefaultPointcutAdvisor</span><span class="p">(</span><span class="n">pointcut</span><span class="p">,</span> <span class="nf">customizableTraceInterceptor</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>The details of the pointcut expression depend on what classes you want to target. I just wanted to know about all services and components.<p>Notice that we do not need any explicit Spring AOP dependency or any other application configuration. The entire trace logging is self-contained and can be deployed from day one. You can copy-paste this class, and it works immediately.<p>By default, the traces are logged as trace, so set the logging level accordingly. My <code class="language-plaintext highlighter-rouge">application.yml</code> contains the following during development, where the last part is my root package name.<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">logging</span><span class="pi">:</span>
  <span class="na">level</span><span class="pi">:</span>
    <span class="na">me.avo.yunyin</span><span class="pi">:</span> <span class="s">TRACE</span>
</code></pre></div></div><h3 id="conclusion">Conclusion</h3><p>No, or greatly reduced need to write debug statements! Thanks to proxying, your code stays clean, whilst Spring works its magic.<p>For production use, you will of course have to adapt your logging, but during development this is value for no money.<p>I will experiment further to see how far I can push this, but this will definitely be a part of every future app I work on.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2020-09-27-spring-aop-logging/">Spring AOP - CustomizableTraceInterceptor</a></footer></article><article id="post-blog-software-spring-kotlin-gradle-aop" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2020-02-20-spring-kotlin-gradle-aop/" class="flip-title"> Aspect Oriented Programming: Spring, Kotlin, Gradle </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2020-02-20T00:00:00-08:00">20 Feb 2020</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 01 May 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-05-01T21:21:41-07:00">2025-05-01</time> </span></div><p class="note-sm" > System architecture and compile-time checks using AOP.</header><ul id="markdown-toc"><li><a href="#setup" id="markdown-toc-setup">Setup</a><li><a href="#aspects" id="markdown-toc-aspects">Aspects</a><ul><li><a href="#pointcuts" id="markdown-toc-pointcuts">Pointcuts</a></ul><li><a href="#compile-time-checks" id="markdown-toc-compile-time-checks">Compile-time checks</a></ul><p>I’ve seen a lot of resources regarding AOP for Java and / or Maven, but couldn’t find a lot about the Kotlin+Gradle combo. As for the Spring side, <a href="https://start.spring.io/">the Spring Initializr </a> doesn’t even list the aop starter, which is apparently by design. So I decided to show a working solution for the mentioned stack. The code referenced can be found <a href="https://github.com/AndreasVolkmann/Spring-Reactive-Security">here</a>.<p>Aspect oriented programming is a great way of defining cross-cutting concerns that can simplify your project and help establish your architecture.<h3 id="setup">Setup</h3><p>First thing is to add the required dependencies to the build.<ul><li>The spring aop starter is needed for defining aspects.<li>The aspectj plugin is needed for compile-time checks.</ul><p>See <a href="https://github.com/AndreasVolkmann/Spring-Reactive-Security/blob/master/build.gradle.kts#L7">the reference build file</a>.<p>There are a bunch of gradle plugins, but most are outdated and lack proper documentation. The freefair plugin was the only one I could get to work, <a href="https://docs.freefair.io/gradle-plugins/current/reference/#_aspectj">documentation here</a>. Just add the post-compile-weaving plugin and set your aspectj version in <code class="language-plaintext highlighter-rouge">gradle.properties</code>.<h3 id="aspects">Aspects</h3><p>Now we can start writing a custom aspect. <a href="https://github.com/AndreasVolkmann/Spring-Reactive-Security/blob/master/src/main/kotlin/com/example/demo/config/aspect/ActivityAspect.kt">The example</a> shows an aspect that monitors all activities by logging start and end events including the time elapsed and whether it succeeded or failed. Using <code class="language-plaintext highlighter-rouge">@Around</code> advice we can wrap all methods that match the defined pointcut in a try-catch-finally.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Aspect</span>
<span class="nd">@Component</span>
<span class="kd">class</span> <span class="nc">ActivityAspect</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">logger</span> <span class="p">=</span> <span class="nc">LoggerFactory</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="k">this</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>

    <span class="nd">@Around</span><span class="p">(</span><span class="s">"Architecture.activity() || Architecture.repository() || Architecture.service()"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">monitorActivity</span><span class="p">(</span><span class="n">proceedingJoinPoint</span><span class="p">:</span> <span class="nc">ProceedingJoinPoint</span><span class="p">):</span> <span class="nc">Any</span><span class="p">?</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">name</span> <span class="p">=</span> <span class="n">proceedingJoinPoint</span><span class="p">.</span><span class="n">staticPart</span><span class="p">.</span><span class="n">signature</span><span class="p">.</span><span class="nf">toShortString</span><span class="p">()</span>
        <span class="kd">var</span> <span class="py">state</span> <span class="p">=</span> <span class="s">"SUCCESS"</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s">"Activity start: $name"</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">startTime</span> <span class="p">=</span> <span class="nc">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">()</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">proceedingJoinPoint</span><span class="p">.</span><span class="nf">proceed</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">ex</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">state</span> <span class="p">=</span> <span class="s">"ERROR"</span>
            <span class="k">throw</span> <span class="n">ex</span>
        <span class="p">}</span>
        <span class="k">finally</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">timeElapsed</span> <span class="p">=</span> <span class="nc">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">()</span> <span class="p">-</span> <span class="n">startTime</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s">"Activity end: $name ($state $timeElapsed ms)"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="pointcuts">Pointcuts</h4><p>In order to define what methods the advice is applied to, pointcuts can be used to describe the architecture of the application. <a href="https://github.com/AndreasVolkmann/Spring-Reactive-Security/blob/master/src/main/kotlin/com/example/demo/config/aspect/Architecture.kt">In the example</a> we want to monitor all public methods in any service or repository, as well as any method annotated with a custom <code class="language-plaintext highlighter-rouge">@Activity</code> annotation.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Architecture</span> <span class="p">{</span>

    <span class="nd">@Pointcut</span><span class="p">(</span><span class="s">"execution(* (@org.springframework.stereotype.Repository *).*(..))"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">service</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Unit</span>

    <span class="nd">@Pointcut</span><span class="p">(</span><span class="s">"execution (* (@org.springframework.stereotype.Service *).*(..))"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">repository</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Unit</span>

    <span class="nd">@Pointcut</span><span class="p">(</span><span class="s">"(@annotation(Activity) &amp;&amp; execution(* *(..)))"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">activity</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Unit</span>
<span class="p">}</span>
</code></pre></div></div><p>Here is a demo service that would match these pointcuts:<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">class</span> <span class="nc">DemoService</span> <span class="p">{</span>

    <span class="nd">@Activity</span> <span class="c1">// optional, can be used on methods outside of services / repositories</span>
    <span class="k">fun</span> <span class="nf">run</span><span class="p">(</span><span class="n">someBool</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">):</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="o">..</span><span class="p">.</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">noAnnotation</span><span class="p">()</span> <span class="p">{</span>
        <span class="o">..</span><span class="p">.</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="compile-time-checks">Compile-time checks</h3><p>AspectJ can be used to define compile-time checks that produce errors or warnings when matched. For example, we can introduce a check that ensures that no code from the <code class="language-plaintext highlighter-rouge">java.sql</code> or <code class="language-plaintext highlighter-rouge">javax.sql</code> package is called outside of a repository.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Aspect</span>
<span class="kd">class</span> <span class="nc">CheckAspect</span> <span class="p">{</span>

    <span class="nd">@DeclareError</span><span class="p">(</span><span class="s">"!Architecture.repository() &amp;&amp; (call (* java.sql..*.*(..)) || call (* javax.sql..*.*(..)))"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">jdbcOutsideRepository</span> <span class="p">=</span> <span class="s">"Only call jdbc code from within repositories."</span>
<span class="p">}</span>
</code></pre></div></div><p>When compiling the following function, the compiler will throw an error.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">methodUsingJavaxSql</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">javax</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">rowset</span><span class="p">.</span><span class="nc">RowSetMetaDataImpl</span><span class="p">().</span><span class="nf">getCatalogName</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><p>I am really happy with the results and the fact that the Spring team is pushing and actively promoting Kotlin as the language of choice. One issue that still remains is handling suspending functions with AOP, since <code class="language-plaintext highlighter-rouge">proceed</code> will return when suspending. Hopefully the fix makes it into the next release. <a href="https://github.com/spring-projects/spring-framework/issues/22462">Tracking issue here</a>.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2020-02-20-spring-kotlin-gradle-aop/">Aspect Oriented Programming: Spring, Kotlin, Gradle</a></footer></article><article id="post-blog-software-m3u8-and-ts-segments" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> <a href="/blog/software/2018-04-27-m3u8-and-ts-segments/" class="flip-title"> M3U8 playlists and .ts segments </a></h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2018-04-27T00:00:00-07:00">27 Apr 2018</time> in <span>Blog</span> / <a href="/software/" class="flip-title">Software</a> </span> <span class="ellipsis" data-tippy-content="Last modified at: 01 May 2025"> <span class="sr-only">Last modified at:</span> <span class="icon-history"></span> <time datetime="2025-05-01T19:51:18-07:00">2025-05-01</time> </span></div><p class="note-sm" > Converting a M3U8 playlist to an mp3 file</header><ol id="markdown-toc"><li><a href="#master-playlist" id="markdown-toc-master-playlist">Master Playlist</a><li><a href="#media-playlist" id="markdown-toc-media-playlist">Media Playlist</a><li><a href="#encryption" id="markdown-toc-encryption">Encryption</a><li><a href="#demux" id="markdown-toc-demux">Demux</a><li><a href="#merging" id="markdown-toc-merging">Merging</a></ol><p>I was recently working on my <a href="https://github.com/AndreasVolkmann/nhk-easy-kumo">NHK-Easy web crawler project</a>, since the site got an update with a number of breaking changes. One of these changes was concerning the audio of the articles.<p>Previously, each article had a corresponding static .mp3 resource. The update introduced a new HLS (HTTP Live Streaming) media player, accompanied by a M3U8 playlist. Furthermore, I observed that the audio was now split into several ts file segments, which were loaded on demand.<p>I had never worked with these file types before, so off I went to google. However, it wasn’t exactly easy to find answers to my questions, which is why I decided to summarize my findings here, in case other people have similar issues. Also, I wanted to have a go at writing my first post.<blockquote><p>Given a master M3U8 playlist, the goal is to end up with a single mp3 file.</blockquote><p><img src="/assets/img/m3u8.png" alt="Overview of M3U8 playlist structure." /><h3 id="master-playlist">Master Playlist</h3><p>The first step when dealing with M3U8, is parsing the master playlist.<p>I found the open-m3u8 library by iHeartRadio works best. The alternative is Comcast’s hlsparserj, but it lacks features and requires more manual work.<p>Once the master playlist is parsed, one can read its content, which consists of one or more media playlists.<h3 id="media-playlist">Media Playlist</h3><p>A typical media playlist could look like the following.<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">#EXTM3U</span>
<span class="nf">#EXT-X-TARGETDURATION</span><span class="o">:</span><span class="err">6</span>
<span class="nf">#EXT-X-ALLOW-CACHE</span><span class="nd">:YES</span>
<span class="nf">#EXT-X-KEY</span><span class="nd">:METHOD</span><span class="o">=</span><span class="nt">AES-128</span><span class="o">,</span><span class="nt">URI</span><span class="o">=</span><span class="s1">"https://site.net/path/to/resource.mp4/crypt.key?id=somekey"</span>
<span class="nf">#EXT-X-PLAYLIST-TYPE</span><span class="nd">:VOD</span>
<span class="nf">#EXT-X-VERSION</span><span class="o">:</span><span class="err">3</span>
<span class="nf">#EXT-X-MEDIA-SEQUENCE</span><span class="o">:</span><span class="err">1</span>
<span class="nf">#EXTINF</span><span class="o">:</span><span class="err">6</span><span class="o">.</span><span class="err">000</span><span class="o">,</span>
<span class="nt">https</span><span class="o">://</span><span class="nt">site</span><span class="nc">.net</span><span class="o">/</span><span class="nt">path</span><span class="o">/</span><span class="nt">to</span><span class="o">/</span><span class="nt">resource</span><span class="nc">.mp4</span><span class="o">/</span><span class="nt">segment1_0_a</span><span class="nc">.ts</span>
<span class="nf">#EXTINF</span><span class="o">:</span><span class="err">6</span><span class="o">.</span><span class="err">000</span><span class="o">,</span>
<span class="nt">https</span><span class="o">://</span><span class="nt">site</span><span class="nc">.net</span><span class="o">/</span><span class="nt">path</span><span class="o">/</span><span class="nt">to</span><span class="o">/</span><span class="nt">resource</span><span class="nc">.mp4</span><span class="o">/</span><span class="nt">segment2_0_a</span><span class="nc">.ts</span>
<span class="nf">#EXTINF</span><span class="o">:</span><span class="err">6</span><span class="o">.</span><span class="err">000</span><span class="o">,</span>
<span class="nt">https</span><span class="o">://</span><span class="nt">site</span><span class="nc">.net</span><span class="o">/</span><span class="nt">path</span><span class="o">/</span><span class="nt">to</span><span class="o">/</span><span class="nt">resource</span><span class="nc">.mp4</span><span class="o">/</span><span class="nt">segment3_0_a</span><span class="nc">.ts</span>
<span class="nf">#EXTINF</span><span class="o">:</span><span class="err">1</span><span class="o">.</span><span class="err">992</span><span class="o">,</span>
<span class="nt">https</span><span class="o">://</span><span class="nt">site</span><span class="nc">.net</span><span class="o">/</span><span class="nt">path</span><span class="o">/</span><span class="nt">to</span><span class="o">/</span><span class="nt">resource</span><span class="nc">.mp4</span><span class="o">/</span><span class="nt">segment4_0_a</span><span class="nc">.ts</span>
<span class="nf">#EXT-X-ENDLIST</span>
</code></pre></div></div><p>It contains an url for each segment that the stream is made up of. Additionally, there are a number of meta tags, of which one is particularly important.<h3 id="encryption">Encryption</h3><p>What took me the longest to figure out was that the segments were encrypted. According to specification, MPEG-TS files (.ts) start with a BOM (Byte Order Mark) in the form of the ASCII char <code class="language-plaintext highlighter-rouge">G</code>. What confused me was, that there was no <code class="language-plaintext highlighter-rouge">G</code>, since the files were encrypted. Lesson learned, go read <a href="https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-3">the specification</a>.<p>Here is how I handle the encryption.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">getCipher</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">EncryptionData</span><span class="p">):</span> <span class="nc">Cipher</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">bytes</span> <span class="p">=</span> <span class="nc">URL</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">uri</span><span class="p">).</span><span class="nf">readBytes</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">chainmode</span> <span class="p">=</span> <span class="s">"CBC"</span>
    <span class="kd">val</span> <span class="py">method</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">EncryptionMethod</span><span class="p">.</span><span class="nc">AES</span> <span class="p">-&gt;</span> <span class="s">"AES/$chainmode/NoPadding"</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">data</span><span class="p">.</span><span class="n">method</span><span class="p">.</span><span class="n">name</span>
    <span class="p">}</span>
    <span class="kd">val</span> <span class="py">keySpec</span> <span class="p">=</span> <span class="nc">SecretKeySpec</span><span class="p">(</span><span class="n">bytes</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">method</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">trace</span><span class="p">(</span><span class="s">"Decrypting using method ${data.method} ($method)"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nc">Cipher</span>
        <span class="p">.</span><span class="nf">getInstance</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">init</span><span class="p">(</span><span class="nc">Cipher</span><span class="p">.</span><span class="nc">DECRYPT_MODE</span><span class="p">,</span> <span class="n">keySpec</span><span class="p">,</span> <span class="nc">IvParameterSpec</span><span class="p">(</span><span class="nc">ByteArray</span><span class="p">(</span><span class="mi">16</span><span class="p">)))</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">EncryptionData</code> can be obtained from any track of the media playlist.<p>Critical for the success of decryption were the <code class="language-plaintext highlighter-rouge">chainmode</code> and the <code class="language-plaintext highlighter-rouge">NoPadding</code> argument.<ul><li>Without any of those, e.g. just <code class="language-plaintext highlighter-rouge">AES</code>, the decryption would throw.<li>With <code class="language-plaintext highlighter-rouge">NoPadding</code>, but a different <code class="language-plaintext highlighter-rouge">chainmode</code>, decryption would succeed, but the files were corrupted.</ul><p>I simply used trial and error until I found the right combination.<h3 id="demux">Demux</h3><p>MPEG-TS files are not the most ordinary media format and are therefore more difficult to work with. Instead of .ts files, it would be nice if we could just work with the audio as wav files. I have tried to find a way to do this in java, but ended up using FFMPEG because there was no suitable library for the job. There is <a href="https://github.com/jcodec/jcodec">JCodec</a>, but the api is awkward and it doesn’t seem like the required format is supported. FFMPEG is pretty easy to use via cli and supports a range of formats.<p>To demux a .ts segment to a .wav file, simply use the below code, where the target is a .wav File.<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ffmpeg</span> <span class="o">-</span><span class="n">i</span> <span class="err">$</span><span class="o">{</span><span class="n">source</span><span class="o">.</span><span class="na">absolutePath</span><span class="o">}</span> <span class="err">$</span><span class="o">{</span><span class="n">target</span><span class="o">.</span><span class="na">absolutePath</span><span class="o">}</span>
</code></pre></div></div><p>Converting wav to mp3 is similarly easy:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ffmpeg</span> <span class="o">-</span><span class="n">i</span> <span class="err">$</span><span class="o">{</span><span class="n">file</span><span class="o">.</span><span class="na">absolutePath</span><span class="o">}</span> <span class="o">-</span><span class="n">acodec</span> <span class="n">libmp3lame</span> <span class="err">$</span><span class="o">{</span><span class="n">target</span><span class="o">.</span><span class="na">absolutePath</span><span class="o">}</span>
</code></pre></div></div><h3 id="merging">Merging</h3><p>Last step: merging the individual segments into one file.<p>I use the following to merge audio streams.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">joinAudioStreams</span><span class="p">(</span><span class="n">streams</span><span class="p">:</span> <span class="nc">Collection</span><span class="p">&lt;</span><span class="nc">AudioInputStream</span><span class="p">&gt;):</span> <span class="nc">AudioInputStream</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">vector</span> <span class="p">=</span> <span class="nc">Vector</span><span class="p">&lt;</span><span class="nc">InputStream</span><span class="p">&gt;(</span><span class="n">streams</span><span class="p">).</span><span class="nf">elements</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">format</span> <span class="p">=</span> <span class="n">streams</span><span class="p">.</span><span class="nf">first</span><span class="p">().</span><span class="n">format</span>
    <span class="k">return</span> <span class="nc">AudioInputStream</span><span class="p">(</span>
        <span class="nc">SequenceInputStream</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span>
        <span class="n">format</span><span class="p">,</span>
        <span class="n">streams</span>
            <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">frameLength</span> <span class="p">}</span>
            <span class="p">.</span><span class="nf">reduce</span><span class="p">(</span><span class="nc">Long</span><span class="o">::</span><span class="n">plus</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><p>AudioInputStreams are obtained from files using <code class="language-plaintext highlighter-rouge">AudioSystem.getAudioInputStream</code> and writing to file is done with <code class="language-plaintext highlighter-rouge">AudioSystem.write</code>.<p>And that’s basically how I went from M3U8 playlists and encrypted ts segments to a single mp3.<footer><p class="read-more"> Continue reading <a class="heading flip-title" href="/blog/software/2018-04-27-m3u8-and-ts-segments/">M3U8 playlists and .ts segments</a></footer></article><h2 class="sr-only">Pagination</h2><nav class="pagination heading clearfix" role="navigation"><ul><li class="pagination-item older" > <span class=" ">Older</span><li class="pagination-item newer" > <a class=" " href="/" rel="prev" >Newer</a></ul></nav><footer class="content" role="contentinfo"><hr/><p><small class="copyright">© 2025. All rights reserved. </small><hr class="sr-only"/></footer></main></hy-push-state> <script nomodule>(()=>{var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())})(); </script> <script src="/assets/js/hydejack-9.2.1.js" type="module"></script> <script src="/assets/js/LEGACY-hydejack-9.2.1.js" nomodule defer></script> <script> document.getElementById('_pushState').addEventListener('hy-push-state-after', function (e) { function e(e){ (console.error?console.error:console.log).call(console,e) } function t(e){ return l.innerHTML='<a href="'+e.replace(/"/g,"&quot;")+'"></a>',l.childNodes[0].getAttribute("href") } function r(e,t){ var r=e.substr(t,2);return parseInt(r,16) } function n(e,n){ for(var o="",c=r(e,n),a=n+2;a<e.length;a+=2){ var l=r(e,a)^c; o+=String.fromCharCode(l) } return t(o) } var o="/cdn-cgi/l/email-protection#", c=".__cf_email__", a="data-cfemail", l=document.createElement("div"); !function(){ for(var t=document.getElementsByTagName("a"),r=0;r<t.length;r++) try{ var c=t[r],a=c.href.indexOf(o); a>-1&&(c.href="mailto:"+n(c.href,a+o.length)) }catch(t){ e(t) } }(), function(){ for(var t=document.querySelectorAll(c),r=0;r<t.length;r++) try{ var o=t[r],l=n(o.getAttribute(a),0),i=document.createTextNode(l); o.parentNode.replaceChild(i,o) }catch(t){ e(t) } }() }); </script><div hidden><h2 class="sr-only">Templates (for web app):</h2><template id="_animation-template"><div class="animation-main fixed-top"><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="icon-link"></span> </a> </template> <template id="_dark-mode-template"> <button id="_dark-mode" class="nav-btn no-hover" > <span class="sr-only">Dark Mode</span> <span class="icon-brightness-contrast"></span> </button> </template></div></html>
